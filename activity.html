<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shortest Path Finder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map {
      height: 500px;
    }

    .step-instruction {
      padding: 8px 0;
      border-bottom: 1px solid #e2e8f0;
    }

    .step-instruction:last-child {
      border-bottom: none;
    }

    .custom-pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 0.6;
      }

      50% {
        opacity: 1;
      }

      100% {
        opacity: 0.6;
      }
    }

    .lucide {
      width: 1em;
      height: 1em;
      stroke-width: 2;
      stroke: currentColor;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <header class="text-center mb-8">
      <h1 class="text-3xl font-bold text-blue-600 flex items-center justify-center">
        <svg class="lucide mr-2 h-7 w-7" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
          <circle cx="12" cy="10" r="3"></circle>
        </svg>
        Shortest Path Finder
        <svg class="lucide ml-2 h-7 w-7" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
        </svg>
      </h1>
      <p class="text-gray-600 mt-2">Find the shortest route between locations</p>
    </header>

    <!-- Geolocation Section -->
    <div id="location-finder" class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4 flex items-center">
        <svg class="lucide mr-2 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
          <circle cx="12" cy="10" r="3"></circle>
        </svg>
        Current Location
      </h2>

      <div class="mb-4 bg-blue-50 p-3 rounded-md">
        <div class="flex items-start">
          <svg class="lucide h-5 w-5 text-blue-600 mr-2 mt-0.5 flex-shrink-0" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          <p id="geolocation-info" class="text-sm text-blue-800">
            This app needs your location to find routes from your current position. Your location data is only used for
            route calculation and is never stored.
          </p>
        </div>
      </div>

      <button id="get-location-btn"
        class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition duration-300 mb-4 flex items-center justify-center">
        <svg class="lucide mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
          <circle cx="12" cy="10" r="3"></circle>
        </svg>
        Get My Current Location
      </button>

      <!-- Sample locations (hidden by default) -->
      <div id="sample-locations" class="mb-4 hidden">
        <h3 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
          <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          Sample Locations:
        </h3>
        <div class="grid grid-cols-2 gap-2">
          <button data-city="new-york"
            class="sample-location-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-sm py-1 px-2 rounded transition-colors">
            New York
          </button>
          <button data-city="london"
            class="sample-location-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-sm py-1 px-2 rounded transition-colors">
            London
          </button>
          <button data-city="tokyo"
            class="sample-location-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-sm py-1 px-2 rounded transition-colors">
            Tokyo
          </button>
          <button data-city="sydney"
            class="sample-location-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-sm py-1 px-2 rounded transition-colors">
            Sydney
          </button>
        </div>
      </div>

      <div id="loading" class="text-center py-4 hidden">
        <svg class="lucide inline-block h-8 w-8 animate-spin text-blue-500" xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24">
          <line x1="12" y1="2" x2="12" y2="6"></line>
          <line x1="12" y1="18" x2="12" y2="22"></line>
          <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
          <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
          <line x1="2" y1="12" x2="6" y2="12"></line>
          <line x1="18" y1="12" x2="22" y2="12"></line>
          <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
          <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
        </svg>
        <p class="mt-2 text-gray-600">Fetching your location...</p>
      </div>

      <div id="error" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 flex items-start hidden">
        <svg class="lucide h-5 w-5 mr-2 flex-shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <div>
          <p id="error-text" class="font-medium"></p>
          <button id="show-help-btn" class="text-sm text-red-600 underline mt-1 flex items-center hidden">
            <svg class="lucide h-3 w-3 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            Show me how to enable location
          </button>
        </div>
      </div>

      <div id="permission-help" class="bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-4 hidden">
        <h3 class="font-medium text-yellow-800 flex items-center mb-2">
          <svg class="lucide h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path
              d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z">
            </path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
          How to enable location access
        </h3>

        <ol class="list-decimal pl-5 text-sm text-yellow-800 space-y-1">
          <li>Click the lock or info icon in the address bar</li>
          <li>Look for "Location" or "Site settings" in the menu</li>
          <li>Change the permission to "Allow"</li>
          <li>Refresh this page and try again</li>
        </ol>

        <div class="mt-3 text-xs text-yellow-700">
          <p class="flex items-center">
            <svg class="lucide h-3 w-3 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            If you prefer not to share your location, you can manually enter your starting point in the form below.
          </p>
        </div>
      </div>

      <div id="location-display" class="space-y-2 hidden">
        <p class="flex items-start">
          <svg class="lucide h-5 w-5 mr-2 flex-shrink-0 mt-0.5 text-blue-600" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          <span>
            <span class="font-semibold">Coordinates:</span>
            <span id="lat"></span>, <span id="lon"></span>
            <span class="text-sm text-gray-500">
              (Accuracy: <span id="acc"></span> meters)
            </span>
          </span>
        </p>
        <p class="flex items-start">
          <svg class="lucide h-5 w-5 mr-2 flex-shrink-0 mt-0.5 text-green-600" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <span>
            <span class="font-semibold">Address:</span> <span id="address"></span>
          </span>
        </p>
        <button id="use-current-location"
          class="mt-2 bg-blue-600 hover:bg-blue-700 text-white font-medium py-1 px-3 rounded-md text-sm transition duration-300 flex items-center">
          <svg class="lucide mr-1 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          Use as Starting Point
        </button>
      </div>

      <div id="manual-entry-reminder" class="mt-4 border-t border-gray-200 pt-4">
        <p class="text-sm text-gray-600 flex items-center">
          <svg class="lucide h-4 w-4 mr-1 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          You can also manually enter your starting location in the form below.
        </p>
      </div>
    </div>

    <!-- Search Container -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <form id="route-form">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div>
            <label for="origin" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
              <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              Starting Point
              <span id="origin-hint" class="ml-1 text-xs text-gray-500 font-normal">(enter address or
                coordinates)</span>
            </label>
            <div class="relative">
              <input type="text" id="origin" placeholder="Enter starting location"
                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                required>
              <svg class="lucide absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"
                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
            </div>
            <p class="text-xs text-gray-500 mt-1 flex items-center">
              <svg class="lucide h-3 w-3 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
              </svg>
              Examples: "123 Main St, New York" or "40.7128, -74.0060"
            </p>
          </div>
          <div>
            <label for="destination" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
              <svg class="lucide mr-1 h-4 w-4 text-red-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
              </svg>
              Destination
            </label>
            <div class="relative">
              <input type="text" id="destination" placeholder="Enter destination"
                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                required>
              <svg class="lucide absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"
                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
              </svg>
            </div>
          </div>
        </div>

        <div class="mb-4">
          <label for="travel-mode" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
            <svg id="travel-mode-icon" class="lucide h-5 w-5 mr-1" xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24">
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
              <line x1="8" y1="21" x2="16" y2="21"></line>
              <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            <span>Travel Mode</span>
          </label>
          <select id="travel-mode"
            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="driving-car">Car</option>
            <option value="driving-hgv">Heavy Goods Vehicle</option>
            <option value="cycling-regular">Bicycle</option>
            <option value="cycling-road">Road Bicycle</option>
            <option value="cycling-mountain">Mountain Bike</option>
            <option value="cycling-electric">E-Bike</option>
            <option value="foot-walking">Walking</option>
            <option value="foot-hiking">Hiking</option>
          </select>
        </div>

        <button type="submit" id="find-route"
          class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-300 flex items-center justify-center">
          <svg class="lucide mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="22" y1="12" x2="18" y2="12"></line>
            <line x1="6" y1="12" x2="2" y2="12"></line>
            <line x1="12" y1="6" x2="12" y2="2"></line>
            <line x1="12" y1="22" x2="12" y2="18"></line>
          </svg>
          Find Shortest Path
        </button>
      </form>
    </div>

    <!-- Map Container -->
    <div id="map" class="rounded-lg shadow-md mb-6"></div>

    <!-- Route Info -->
    <div id="route-details" class="bg-white rounded-lg shadow-md p-6 hidden">
      <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
        <svg class="lucide mr-2 h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="22" y1="12" x2="18" y2="12"></line>
          <line x1="6" y1="12" x2="2" y2="12"></line>
          <line x1="12" y1="6" x2="12" y2="2"></line>
          <line x1="12" y1="22" x2="12" y2="18"></line>
        </svg>
        Route Details
      </h3>

      <!-- Summary Card -->
      <div id="distance-duration" class="bg-blue-50 p-4 rounded-md mb-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="flex items-center">
            <svg class="lucide mr-2 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span class="font-semibold">Total Distance:</span>
            <span id="total-distance" class="text-blue-600 ml-2"></span>
          </div>
          <div class="flex items-center">
            <svg class="lucide mr-2 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span class="font-semibold">Travel Time:</span>
            <span id="travel-time" class="text-blue-600 ml-2"></span>
          </div>
          <div class="flex items-center">
            <svg class="lucide mr-2 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span class="font-semibold">Estimated Arrival:</span>
            <span id="estimated-arrival" class="text-blue-600 ml-2"></span>
          </div>
          <div class="flex items-center">
            <svg class="lucide mr-2 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span class="font-semibold">Average Speed:</span>
            <span id="average-speed" class="text-blue-600 ml-2"></span>
          </div>
        </div>
      </div>

      <!-- Detailed Time Information -->
      <div class="mb-4 border border-gray-200 rounded-md overflow-hidden">
        <button id="time-details-btn"
          class="w-full p-3 bg-gray-50 flex justify-between items-center hover:bg-gray-100 transition-colors">
          <div class="flex items-center font-medium text-gray-700">
            <svg class="lucide mr-2 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            Detailed Time Information
          </div>
          <svg id="time-details-chevron" class="lucide h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>

        <div id="time-details-content" class="p-4 bg-white hidden">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Departure Time</span>
              <span id="departure-time" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
              </span>
            </div>
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Arrival Time</span>
              <span id="arrival-time" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-red-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                </svg>
              </span>
            </div>
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Total Duration</span>
              <span id="total-duration" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
              </span>
            </div>
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Average Speed</span>
              <span id="avg-speed-detail" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                  <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
              </span>
            </div>
          </div>

          <div class="mt-4">
            <h5 class="font-medium text-gray-700 mb-2">Time Breakdown</h5>
            <div class="bg-gray-100 rounded-md p-3">
              <div class="flex justify-between mb-1">
                <span class="text-sm">Travel Time</span>
                <span id="travel-time-breakdown" class="text-sm font-medium"></span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div class="bg-blue-600 h-2.5 rounded-full" style="width: 100%"></div>
              </div>

              <div class="mt-3 text-xs text-gray-500">
                <p>* Time estimates are based on current traffic conditions and may vary.</p>
                <p>* Arrival time does not account for stops along the route.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Detailed Route Information -->
      <div class="mb-4 border border-gray-200 rounded-md overflow-hidden">
        <button id="route-details-btn"
          class="w-full p-3 bg-gray-50 flex justify-between items-center hover:bg-gray-100 transition-colors">
          <div class="flex items-center font-medium text-gray-700">
            <svg class="lucide mr-2 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
            </svg>
            Detailed Route Information
          </div>
          <svg id="route-details-chevron" class="lucide h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>

        <div id="route-details-content" class="p-4 bg-white hidden">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Total Distance</span>
              <span id="total-distance-detail" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
              </span>
            </div>
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Total Turns</span>
              <span id="total-turns" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <polyline points="9 6 15 12 9 18"></polyline>
                </svg>
              </span>
            </div>
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Turn Breakdown</span>
              <span id="turn-breakdown" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <polyline points="9 6 15 12 9 18"></polyline>
                </svg>
              </span>
            </div>
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Roundabouts</span>
              <span id="roundabouts" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M22 12c0 6-4.39 10-9.806 10C7.792 22 2.1 19.24 2 12 1.9 4.76 7.792 2 12.194 2 17.61 2 22 6 22 12z">
                  </path>
                  <path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"></path>
                </svg>
              </span>
            </div>
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Straight Segments</span>
              <span id="straight-segments" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
              </span>
            </div>
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Longest Segment</span>
              <span id="longest-segment" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M18 6H5a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h13l4-3.5L18 6Z"></path>
                  <path d="M12 13v8"></path>
                  <path d="M12 3v3"></path>
                </svg>
              </span>
            </div>
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Average Segment</span>
              <span id="average-segment" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M7 21V11l-2 2"></path>
                  <path d="M17 21V7l2 2"></path>
                  <path d="M17 7l-2-2H9l-2 2"></path>
                  <path d="M7 11l2-2h6l2 2"></path>
                </svg>
              </span>
            </div>
            <div class="flex flex-col">
              <span class="text-sm text-gray-500">Total Steps</span>
              <span id="total-steps" class="font-medium flex items-center">
                <svg class="lucide mr-1 h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon>
                </svg>
              </span>
            </div>
          </div>

          <div class="mt-4">
            <h5 class="font-medium text-gray-700 mb-2">Route Visualization</h5>
            <div id="route-visualization" class="bg-gray-100 rounded-md p-3 flex items-center justify-center h-24">
              <div class="flex items-end space-x-1 h-full">
                <!-- Step bars will be added here dynamically -->
              </div>
            </div>
            <div class="mt-3 text-xs text-gray-500">
              <p>* Each bar represents a navigation step, with height proportional to distance.</p>
              <p>* Hover over bars to see detailed step information.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Turn-by-Turn Directions -->
      <div id="directions-container" class="space-y-2">
        <h4 class="font-medium text-gray-700 mb-2 flex items-center">
          <svg class="lucide mr-2 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
          </svg>
          Turn-by-Turn Directions:
        </h4>
        <div id="directions-panel"></div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Global variables
    let map;
    let routeLayer;
    let currentLocationMarker;
    let geolocationDisabled = false;

    // Initialize the map when the page loads
    document.addEventListener('DOMContentLoaded', function () {
      initMap();
      setupEventListeners();
      checkGeolocationAvailability();
    });

    function initMap() {
      map = L.map('map').setView([20, 0], 2);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      // Initialize route layer
      routeLayer = L.layerGroup().addTo(map);
    }

    function setupEventListeners() {
      // Location finder
      document.getElementById('get-location-btn').addEventListener('click', getLocation);
      document.getElementById('use-current-location').addEventListener('click', useCurrentLocationAsOrigin);
      document.getElementById('show-help-btn').addEventListener('click', togglePermissionHelp);

      // Sample locations
      document.querySelectorAll('.sample-location-btn').forEach(btn => {
        btn.addEventListener('click', function () {
          useSampleLocation(this.dataset.city);
        });
      });

      // Route form
      document.getElementById('route-form').addEventListener('submit', function (e) {
        e.preventDefault();
        findShortestPath();
      });

      // Travel mode icon update
      document.getElementById('travel-mode').addEventListener('change', updateTravelModeIcon);

      // Collapsible sections
      document.getElementById('time-details-btn').addEventListener('click', function () {
        toggleSection('time-details-content', 'time-details-chevron');
      });

      document.getElementById('route-details-btn').addEventListener('click', function () {
        toggleSection('route-details-content', 'route-details-chevron');
      });

      // Initialize travel mode icon
      updateTravelModeIcon();
    }

    function checkGeolocationAvailability() {
      try {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function () {
              // Success - geolocation is available and permitted
              geolocationDisabled = false;
            },
            function (err) {
              // Check for permissions policy error
              if (err.message && (
                err.message.includes('permissions policy') ||
                err.message.includes('Permission denied') ||
                err.message.includes('User denied')
              )) {
                console.log('Geolocation disabled by permissions policy or user denial');
                handleGeolocationDisabled();
              }
            },
            { timeout: 3000 }
          );
        } else {
          handleGeolocationDisabled();
        }
      } catch (err) {
        console.error('Error checking geolocation availability:', err);
        handleGeolocationDisabled();
      }
    }

    function handleGeolocationDisabled() {
      geolocationDisabled = true;
      document.getElementById('get-location-btn').classList.add('hidden');
      document.getElementById('sample-locations').classList.remove('hidden');
      document.getElementById('geolocation-info').textContent =
        'Geolocation is not available in this environment. Please use the sample locations below or enter your location manually in the form.';

      showError('Geolocation has been disabled in this environment. Please enter your location manually.');
    }

    function toggleSection(contentId, chevronId) {
      const content = document.getElementById(contentId);
      const chevron = document.getElementById(chevronId);

      if (content.classList.contains('hidden')) {
        content.classList.remove('hidden');
        chevron.innerHTML = '<polyline points="18 15 12 9 6 15"></polyline>';
      } else {
        content.classList.add('hidden');
        chevron.innerHTML = '<polyline points="6 9 12 15 18 9"></polyline>';
      }
    }

    function updateTravelModeIcon() {
      const travelMode = document.getElementById('travel-mode').value;
      const iconElement = document.getElementById('travel-mode-icon');

      // Set the appropriate icon based on travel mode
      switch (travelMode) {
        case 'driving-car':
          iconElement.innerHTML = '<rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line>';
          break;
        case 'driving-hgv':
          iconElement.innerHTML = '<path d="M10 17h4V5H2v12h3"></path><path d="M20 17h2v-3.34a4 4 0 0 0-1.17-2.83L19 9h-5v8h1"></path><path d="M14 17h1"></path><circle cx="7.5" cy="17.5" r="2.5"></circle><circle cx="17.5" cy="17.5" r="2.5"></circle>';
          break;
        case 'cycling-regular':
        case 'cycling-road':
          iconElement.innerHTML = '<circle cx="5.5" cy="17.5" r="3.5"></circle><circle cx="18.5" cy="17.5" r="3.5"></circle><path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-3 11.5V14l-3-3 4-3 2 3h2"></path>';
          break;
        case 'cycling-mountain':
          iconElement.innerHTML = '<path d="m8 18 4-6-2-4h6"></path><path d="m12 12-2 6"></path><circle cx="6" cy="19" r="3"></circle><circle cx="18" cy="19" r="3"></circle><path d="M6 12h2l1-3h2l1 3h2"></path>';
          break;
        case 'cycling-electric':
          iconElement.innerHTML = '<circle cx="5.5" cy="17.5" r="3.5"></circle><circle cx="18.5" cy="17.5" r="3.5"></circle><path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-3 11.5V14l-3-3 4-3 2 3h2"></path><path d="m7 14-2 3"></path><path d="M13 5 V2"></path><path d="m13 3-2 2"></path><path d="m13 3 2 2"></path>';
          break;
        case 'foot-walking':
          iconElement.innerHTML = '<path d="M13 4v16"></path><path d="M17 4v16"></path><path d="M21 4v16"></path><path d="M8 8l-5 4 5 4"></path>';
          break;
        case 'foot-hiking':
          iconElement.innerHTML = '<path d="m13 4 3 2"></path><path d="m10 7 3-3 3 2"></path><path d="m10 7-1 4 2 1 3-4"></path><path d="m14 10-5 8"></path><path d="m14 10 5 8"></path><path d="M5 21v-5l5-5"></path><path d="M19 21v-5l-5-5"></path>';
          break;
        default:
          iconElement.innerHTML = '<rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line>';
      }
    }

    function togglePermissionHelp() {
      const helpElement = document.getElementById('permission-help');
      const helpButton = document.getElementById('show-help-btn');

      if (helpElement.classList.contains('hidden')) {
        helpElement.classList.remove('hidden');
        helpButton.innerHTML = `
                    <svg class="lucide h-3 w-3 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                    Hide help
                `;
      } else {
        helpElement.classList.add('hidden');
        helpButton.innerHTML = `
                    <svg class="lucide h-3 w-3 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    Show me how to enable location
                `;
      }
    }

    function showError(message, showHelpButton = false) {
      const errorElement = document.getElementById('error');
      const errorText = document.getElementById('error-text');
      const helpButton = document.getElementById('show-help-btn');

      errorText.textContent = message;
      errorElement.classList.remove('hidden');

      if (showHelpButton && !geolocationDisabled) {
        helpButton.classList.remove('hidden');
      } else {
        helpButton.classList.add('hidden');
      }
    }

    function hideError() {
      document.getElementById('error').classList.add('hidden');
      document.getElementById('permission-help').classList.add('hidden');
    }

    function showLoading() {
      document.getElementById('loading').classList.remove('hidden');
    }

    function hideLoading() {
      document.getElementById('loading').classList.add('hidden');
    }

    // Main function to get user's geolocation
    async function getLocation() {
      console.log('=== GEOLOCATION PROCESS STARTED ===');

      if (geolocationDisabled) {
        showError('Geolocation is not available in this environment. Please enter your location manually.');
        return;
      }

      if (!navigator.geolocation) {
        showError('Geolocation is not supported by this browser. Please enter your location manually.');
        return;
      }

      // Show loading indicator, hide any previous errors
      showLoading();
      hideError();
      document.getElementById('location-display').classList.add('hidden');

      // Request the user's position from the browser
      navigator.geolocation.getCurrentPosition(async (position) => {
        // Success callback - browser provided coordinates
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const acc = position.coords.accuracy.toFixed(1);

        console.log(`Coordinates received - Latitude: ${lat}, Longitude: ${lon}, Accuracy: ${acc}m`);

        // Update the UI with coordinate data
        document.getElementById('lat').textContent = lat;
        document.getElementById('lon').textContent = lon;
        document.getElementById('acc').textContent = acc;
        document.getElementById('address').textContent = 'Fetching address...';
        document.getElementById('address').classList.add('custom-pulse');

        try {
          // Get address from coordinates
          const address = await getAddress(lat, lon);
          document.getElementById('address').textContent = address;
          document.getElementById('address').classList.remove('custom-pulse');

          // Show location display
          document.getElementById('location-display').classList.remove('hidden');

          // Add marker to map
          if (currentLocationMarker) {
            currentLocationMarker.remove();
          }
          currentLocationMarker = L.marker([lat, lon]).addTo(map)
            .bindPopup("Your Location: " + address);
          map.setView([lat, lon], 13);

        } catch (error) {
          document.getElementById('address').textContent = 'Address lookup failed';
          document.getElementById('address').classList.remove('custom-pulse');
          console.error('Error during address lookup:', error);
        }

        // Hide loading indicator when done
        hideLoading();
      }, (error) => {
        // Error callback - something went wrong getting coordinates
        hideLoading();

        // Show different error messages based on the error code
        switch (error.code) {
          case error.PERMISSION_DENIED:
            showError("Location permission denied. Please allow location access.", true);
            break;
          case error.POSITION_UNAVAILABLE:
            showError("Location information is unavailable.");
            break;
          case error.TIMEOUT:
            showError("The request to get user location timed out.");
            break;
          default:
            showError("An unknown error occurred.");
        }

        // Check for permissions policy error
        if (error.message && error.message.includes('permissions policy')) {
          handleGeolocationDisabled();
        }
      });
    }

    // Function to use current location as starting point
    function useCurrentLocationAsOrigin() {
      const address = document.getElementById('address').textContent;
      if (address && address !== 'Address lookup failed') {
        document.getElementById('origin').value = address;
        document.getElementById('origin-hint').classList.add('hidden');
      } else {
        const lat = document.getElementById('lat').textContent;
        const lon = document.getElementById('lon').textContent;
        if (lat && lon) {
          document.getElementById('origin').value = `${lat}, ${lon}`;
          document.getElementById('origin-hint').classList.add('hidden');
        }
      }
    }

    // Function to use sample location
    function useSampleLocation(city) {
      let coords, address;

      switch (city) {
        case 'new-york':
          coords = { lat: 40.7128, lng: -74.006 };
          address = "New York, NY, USA";
          break;
        case 'london':
          coords = { lat: 51.5074, lng: -0.1278 };
          address = "London, UK";
          break;
        case 'tokyo':
          coords = { lat: 35.6762, lng: 139.6503 };
          address = "Tokyo, Japan";
          break;
        case 'sydney':
          coords = { lat: -33.8688, lng: 151.2093 };
          address = "Sydney, Australia";
          break;
        default:
          coords = { lat: 40.7128, lng: -74.006 };
          address = "New York, NY, USA";
      }

      // Set as starting point
      document.getElementById('origin').value = address;
      document.getElementById('origin-hint').classList.add('hidden');

      // Add marker to map
      if (currentLocationMarker) {
        currentLocationMarker.remove();
      }
      currentLocationMarker = L.marker([coords.lat, coords.lng]).addTo(map)
        .bindPopup("Sample Location: " + address);
      map.setView([coords.lat, coords.lng], 13);
    }

    // Function to convert coordinates to a readable address using Nominatim API
    async function getAddress(lat, lon) {
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`);
        const data = await response.json();
        return data.display_name || 'Address not found';
      } catch (error) {
        console.error("Error fetching address:", error);
        return 'Error retrieving address';
      }
    }

    async function findShortestPath() {
      const origin = document.getElementById('origin').value;
      const destination = document.getElementById('destination').value;
      const travelMode = document.getElementById('travel-mode').value;

      if (!origin || !destination) {
        showError("Please enter both origin and destination");
        return;
      }

      // Show loading state
      const findRouteBtn = document.getElementById('find-route');
      findRouteBtn.disabled = true;
      findRouteBtn.innerHTML = `
                <svg class="lucide animate-spin mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <line x1="12" y1="2" x2="12" y2="6"></line>
                    <line x1="12" y1="18" x2="12" y2="22"></line>
                    <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
                    <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
                    <line x1="2" y1="12" x2="6" y2="12"></line>
                    <line x1="18" y1="12" x2="22" y2="12"></line>
                    <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
                    <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
                </svg>
                Calculating Route...
            `;

      try {
        // First geocode both locations
        const startCoords = await geocodeAddress(origin);
        const endCoords = await geocodeAddress(destination);

        if (!startCoords || !endCoords) {
          throw new Error("Could not find coordinates for one or both locations");
        }

        // Get the route using OSRM (Open Source Routing Machine)
        const route = await getRoute(startCoords, endCoords, travelMode);

        // Display the route
        displayRoute(route, startCoords, endCoords);

        // Display route information
        displayRouteInfo(route);

        // Show the route details section
        document.getElementById('route-details').classList.remove('hidden');

      } catch (error) {
        showError("Error finding route: " + error.message);
        console.error(error);
      } finally {
        // Reset button state
        findRouteBtn.disabled = false;
        findRouteBtn.innerHTML = `
                    <svg class="lucide mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="22" y1="12" x2="18" y2="12"></line>
                        <line x1="6" y1="12" x2="2" y2="12"></line>
                        <line x1="12" y1="6" x2="12" y2="2"></line>
                        <line x1="12" y1="22" x2="12" y2="18"></line>
                    </svg>
                    Find Shortest Path
                `;
      }
    }

    async function geocodeAddress(address) {
      try {
        // Check if it's coordinates in the format "lat, lng"
        const coordsMatch = address.match(/^\s*(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)\s*$/);
        if (coordsMatch) {
          return {
            lat: parseFloat(coordsMatch[1]),
            lng: parseFloat(coordsMatch[2])
          };
        }

        // Otherwise use Nominatim for geocoding
        const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1`);
        const data = await response.json();

        if (!data || data.length === 0) {
          return null;
        }

        return {
          lat: parseFloat(data[0].lat),
          lng: parseFloat(data[0].lon)
        };
      } catch (error) {
        console.error("Geocoding error:", error);
        return null;
      }
    }

    async function getRoute(start, end, profile) {
      // Map OpenRouteService profiles to OSRM profiles
      let osrmProfile = "car";
      if (profile.startsWith("cycling")) {
        osrmProfile = "bike";
      } else if (profile.startsWith("foot")) {
        osrmProfile = "foot";
      }

      // Convert coordinates to OSRM format (lon,lat)
      const startCoord = `${start.lng},${start.lat}`;
      const endCoord = `${end.lng},${end.lat}`;

      // Use OSRM public API
      const url = `https://router.project-osrm.org/route/v1/${osrmProfile}/${startCoord};${endCoord}?overview=full&geometries=geojson&steps=true`;

      try {
        const response = await fetch(url);

        if (!response.ok) {
          throw new Error(`OSRM API returned ${response.status}`);
        }

        const data = await response.json();

        if (!data.routes || data.routes.length === 0) {
          throw new Error("No route found");
        }

        return data.routes[0];
      } catch (error) {
        console.error("Routing error:", error);
        throw new Error("Failed to calculate route. Please try a different route or travel mode.");
      }
    }

    function displayRoute(route, startCoords, endCoords) {
      // Clear previous route
      routeLayer.clearLayers();

      // Add start and end markers
      L.marker([startCoords.lat, startCoords.lng]).addTo(routeLayer)
        .bindPopup("Start: " + document.getElementById("origin").value);

      L.marker([endCoords.lat, endCoords.lng]).addTo(routeLayer)
        .bindPopup("End: " + document.getElementById("destination").value);

      // Draw the route
      if (route.geometry && route.geometry.coordinates) {
        const latLngs = route.geometry.coordinates.map(coord => L.latLng(coord[1], coord[0]));

        L.polyline(latLngs, {
          color: '#3b82f6',
          weight: 5,
          opacity: 0.8,
          lineJoin: 'round'
        }).addTo(routeLayer);

        // Fit the map to the route bounds
        map.fitBounds(latLngs);
      }
    }

    function displayRouteInfo(route) {
      // Basic route information
      const distance = (route.distance / 1000).toFixed(1);
      const duration = Math.round(route.duration / 60);

      // Update summary card
      document.getElementById('total-distance').textContent = `${distance} km`;
      document.getElementById('travel-time').textContent = `${duration} minutes`;

      // Calculate time statistics
      const now = new Date();
      const arrivalTime = new Date(now.getTime() + route.duration * 1000);
      const averageSpeed = route.distance / 1000 / (route.duration / 3600); // km/h

      document.getElementById('estimated-arrival').textContent =
        `${arrivalTime.toLocaleTimeString()} ${now.toDateString() === arrivalTime.toDateString() ? '' : '(' + arrivalTime.toLocaleDateString() + ')'}`;
      document.getElementById('average-speed').textContent = `${averageSpeed.toFixed(1)} km/h`;

      // Detailed time information
      document.getElementById('departure-time').textContent = now.toLocaleTimeString();
      document.getElementById('arrival-time').textContent =
        `${arrivalTime.toLocaleTimeString()} (${now.toDateString() === arrivalTime.toDateString() ? 'Today' : arrivalTime.toLocaleDateString()})`;

      const durationHours = Math.floor(route.duration / 3600);
      const durationMinutes = Math.floor((route.duration % 3600) / 60);
      const durationSeconds = Math.floor(route.duration % 60);

      document.getElementById('total-duration').textContent =
        `${durationHours > 0 ? durationHours + ' hr ' : ''}${durationMinutes} min ${durationSeconds} sec`;
      document.getElementById('avg-speed-detail').textContent = `${averageSpeed.toFixed(1)} km/h`;
      document.getElementById('travel-time-breakdown').textContent = `${duration} min`;

      // Extract steps from the route
      let steps = [];
      if (route.legs && route.legs.length > 0) {
        route.legs.forEach(leg => {
          if (leg.steps) {
            steps = steps.concat(leg.steps);
          }
        });
      }

      // Calculate route statistics
      const totalTurns = steps.filter(step =>
        step.maneuver && (step.maneuver.type.includes('turn') || step.maneuver.type.includes('roundabout'))
      ).length;

      const rightTurns = steps.filter(step =>
        step.maneuver && step.maneuver.type.includes('turn') && step.maneuver.modifier && step.maneuver.modifier.includes('right')
      ).length;

      const leftTurns = steps.filter(step =>
        step.maneuver && step.maneuver.type.includes('turn') && step.maneuver.modifier && step.maneuver.modifier.includes('left')
      ).length;

      const straightSegments = steps.filter(step =>
        step.maneuver && (step.maneuver.type === 'continue' || step.maneuver.type === 'straight')
      ).length;

      const roundabouts = steps.filter(step =>
        step.maneuver && step.maneuver.type.includes('roundabout')
      ).length;

      const longestSegment = Math.max(...steps.map(step => step.distance)) / 1000;
      const averageSegmentLength = route.distance / 1000 / steps.length;

      // Update route details
      document.getElementById('total-distance-detail').textContent = `${distance} km`;
      document.getElementById('total-turns').textContent = `${totalTurns} turns`;
      document.getElementById('turn-breakdown').textContent = `${rightTurns} right, ${leftTurns} left`;
      document.getElementById('roundabouts').textContent = `${roundabouts} roundabouts`;
      document.getElementById('straight-segments').textContent = `${straightSegments} segments`;
      document.getElementById('longest-segment').textContent = `${longestSegment.toFixed(2)} km`;
      document.getElementById('average-segment').textContent = `${averageSegmentLength.toFixed(2)} km`;
      document.getElementById('total-steps').textContent = `${steps.length} navigation steps`;

      // Create route visualization
      const visualizationContainer = document.getElementById('route-visualization');
      visualizationContainer.innerHTML = '';

      const barsContainer = document.createElement('div');
      barsContainer.className = 'flex items-end space-x-1 h-full';

      steps.forEach((step, index) => {
        const height = Math.min(Math.max((step.distance / route.distance) * 100, 5), 100);
        const bar = document.createElement('div');
        bar.className = 'bg-blue-500 w-2 rounded-t-sm hover:bg-blue-600 transition-colors';
        bar.style.height = `${height}%`;
        bar.title = `Step ${index + 1}: ${(step.distance / 1000).toFixed(2)} km`;
        barsContainer.appendChild(bar);
      });

      visualizationContainer.appendChild(barsContainer);

      // Display turn-by-turn directions
      const directionsPanel = document.getElementById('directions-panel');
      directionsPanel.innerHTML = '';

      if (steps.length > 0) {
        steps.forEach((step, index) => {
          // Format the instruction
          let instruction = '';
          if (step.maneuver) {
            if (step.maneuver.type === 'arrive') {
              instruction = 'You have arrived at your destination';
            } else if (step.maneuver.type === 'depart') {
              instruction = 'Depart from the starting point';
            } else {
              instruction = `${step.maneuver.type} ${step.maneuver.modifier || ''}`.trim();
              // Capitalize first letter
              instruction = instruction.charAt(0).toUpperCase() + instruction.slice(1);
            }
          } else {
            instruction = `Continue for ${(step.distance / 1000).toFixed(2)} km`;
          }

          // Get the appropriate icon
          let iconSvg = '';
          const lowerInstruction = instruction.toLowerCase();

          if (lowerInstruction.includes('arrive')) {
            iconSvg = '<path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>';
          } else if (lowerInstruction.includes('depart')) {
            iconSvg = '<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle>';
          } else if (lowerInstruction.includes('right') && lowerInstruction.includes('turn')) {
            iconSvg = '<polyline points="9 6 15 12 9 18"></polyline>';
          } else if (lowerInstruction.includes('left') && lowerInstruction.includes('turn')) {
            iconSvg = '<polyline points="15 6 9 12 15 18"></polyline>';
          } else if (lowerInstruction.includes('slight right')) {
            iconSvg = '<polyline points="6 9 12 15 18 9"></polyline>';
          } else if (lowerInstruction.includes('slight left')) {
            iconSvg = '<polyline points="18 15 12 9 6 15"></polyline>';
          } else if (lowerInstruction.includes('continue')) {
            iconSvg = '<line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline>';
          } else if (lowerInstruction.includes('straight')) {
            iconSvg = '<line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline>';
          } else if (lowerInstruction.includes('roundabout')) {
            iconSvg = '<path d="M22 12c0 6-4.39 10-9.806 10C7.792 22 2.1 19.24 2 12 1.9 4.76 7.792 2 12.194 2 17.61 2 22 6 22 12z"></path><path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"></path>';
          } else {
            iconSvg = '<line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline>';
          }

          // Calculate ETA for this step
          const stepEta = new Date(
            now.getTime() +
            steps.slice(0, index + 1).reduce((acc, s) => acc + s.duration, 0) * 1000
          ).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

          // Create the step element
          const stepElement = document.createElement('div');
          stepElement.className = 'step-instruction py-2 border-b border-gray-200 last:border-b-0 flex';
          stepElement.innerHTML = `
                        <div class="mr-3 mt-1">
                            <svg class="lucide h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                ${iconSvg}
                            </svg>
                        </div>
                        <div class="flex-1">
                            <p>${instruction}</p>
                            <div class="text-sm text-gray-500 mt-1 flex items-center flex-wrap">
                                <span class="flex items-center mr-3">
                                    <svg class="lucide h-3 w-3 mr-1 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    ${(step.distance / 1000).toFixed(2)} km
                                </span>
                                <span class="flex items-center mr-3">
                                    <svg class="lucide h-3 w-3 mr-1 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    ${Math.round(step.duration / 60) || 1} min
                                </span>
                                ${index < steps.length - 1 ? `
                                <span class="flex items-center">
                                    <svg class="lucide h-3 w-3 mr-1 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    ETA: ${stepEta}
                                </span>
                                ` : ''}
                            </div>
                        </div>
                    `;

          directionsPanel.appendChild(stepElement);
        });
      } else {
        directionsPanel.innerHTML = `
                    <div class="text-gray-600 italic flex items-center">
                        <svg class="lucide mr-2 h-5 w-5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        No detailed directions available for this route.
                    </div>
                `;
      }
    }
  </script>
</body>

</html>