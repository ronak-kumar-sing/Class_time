<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Smart Mirror Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Face-API.js -->
  <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
  <!-- Chart.js for data visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Particles.js for background effects -->
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <!-- Google Sign-In API -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            mirror: {
              dark: '#0f172a',
              darker: '#020617',
              light: '#f8fafc',
              accent: '#6366f1',
              accent2: '#8b5cf6',
              card: 'rgba(30, 41, 59, 0.7)'
            }
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'float': 'float 6s ease-in-out infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-10px)' },
            }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
      background-image: radial-gradient(circle at 1px 1px, rgba(99, 102, 241, 0.15) 1px, transparent 0);
      background-size: 40px 40px;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: 'Space Grotesk', sans-serif;
    }

    .mirror-card {
      backdrop-filter: blur(16px);
      background-color: rgba(30, 41, 59, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    .mirror-card:hover {
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      transform: translateY(-2px);
    }

    .dark .mirror-card {
      background-color: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .pulse-animation {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.05);
        opacity: 0.8;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .gradient-text {
      background: linear-gradient(to right, #6366f1, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .gradient-border {
      position: relative;
      border-radius: 0.75rem;
    }

    .gradient-border::before {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 0.85rem;
      background: linear-gradient(to right, #6366f1, #8b5cf6);
      z-index: -1;
      opacity: 0.5;
    }

    .webcam-container {
      position: relative;
      overflow: hidden;
      border-radius: 0.5rem;
    }

    .face-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .chat-container {
      max-height: 300px;
      overflow-y: auto;
      scrollbar-width: thin;
    }

    .chat-container::-webkit-scrollbar {
      width: 6px;
    }

    .chat-container::-webkit-scrollbar-thumb {
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }

    .user-message {
      background-color: rgba(99, 102, 241, 0.2);
      border-radius: 18px 18px 4px 18px;
    }

    .assistant-message {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 18px 18px 18px 4px;
    }

    .particles-js {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    .glow {
      box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
    }

    .chart-container {
      position: relative;
      height: 250px;
      width: 100%;
    }

    .voice-ripple {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 2px solid rgba(99, 102, 241, 0.5);
      animation: ripple 2s linear infinite;
    }

    @keyframes ripple {
      0% {
        transform: scale(0.8);
        opacity: 1;
      }

      100% {
        transform: scale(1.5);
        opacity: 0;
      }
    }

    .smart-home-button {
      transition: all 0.2s ease;
    }

    .smart-home-button:hover {
      transform: translateY(-3px);
    }

    .smart-home-button.active {
      background-color: rgba(99, 102, 241, 0.8);
      color: white;
    }

    .auth-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .auth-card {
      width: 100%;
      max-width: 450px;
    }

    .tab-active {
      border-bottom: 2px solid #6366f1;
      color: #6366f1;
    }

    .input-field {
      background-color: rgba(30, 41, 59, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      width: 100%;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
    }

    .auth-btn {
      background-color: #6366f1;
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      width: 100%;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .auth-btn:hover {
      background-color: #4f46e5;
      transform: translateY(-2px);
    }

    .social-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      width: 100%;
      font-weight: 500;
      transition: all 0.3s ease;
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 1rem;
    }

    .social-btn:hover {
      background-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .social-btn i {
      margin-right: 0.75rem;
    }

    .or-divider {
      display: flex;
      align-items: center;
      margin: 1.5rem 0;
    }

    .or-divider::before,
    .or-divider::after {
      content: "";
      flex: 1;
      height: 1px;
      background-color: rgba(255, 255, 255, 0.1);
    }

    .or-divider span {
      padding: 0 1rem;
      color: rgba(255, 255, 255, 0.5);
    }

    .face-setup-container {
      text-align: center;
      margin-top: 1.5rem;
    }

    .face-setup-btn {
      background-color: rgba(99, 102, 241, 0.2);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 500;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
    }

    .face-setup-btn:hover {
      background-color: rgba(99, 102, 241, 0.3);
    }

    .face-setup-btn i {
      margin-right: 0.5rem;
    }

    .user-dropdown {
      position: relative;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.5rem;
      width: 200px;
      background-color: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0.5rem;
      padding: 0.5rem;
      z-index: 50;
      backdrop-filter: blur(16px);
      display: none;
    }

    .dropdown-menu.show {
      display: block;
    }

    .dropdown-item {
      padding: 0.5rem 1rem;
      border-radius: 0.25rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
    }

    .dropdown-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .dropdown-item i {
      margin-right: 0.5rem;
      width: 1rem;
    }

    .camera-status {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      z-index: 10;
    }

    .camera-permission-error {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(239, 68, 68, 0.8);
      color: white;
      padding: 1rem;
      border-radius: 0.5rem;
      text-align: center;
      max-width: 80%;
      z-index: 10;
    }

    .face-detection-box {
      position: absolute;
      border: 2px solid #6366f1;
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);
      z-index: 5;
    }

    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 3px solid #6366f1;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body class="dark bg-mirror-dark text-white min-h-screen">
  <!-- Particles Background -->
  <div id="particles-js" class="particles-js"></div>

  <!-- Authentication Container -->
  <div id="auth-container" class="auth-container">
    <div class="auth-card mirror-card rounded-xl p-6">
      <h1 class="text-3xl font-bold text-center mb-6 gradient-text">Smart Mirror</h1>

      <!-- Auth Tabs -->
      <div class="flex border-b border-gray-700 mb-6">
        <button id="login-tab" class="flex-1 py-2 text-center tab-active">Login</button>
        <button id="signup-tab" class="flex-1 py-2 text-center">Sign Up</button>
      </div>

      <!-- Login Form -->
      <div id="login-form">
        <button id="google-login" class="social-btn">
          <i class="fab fa-google"></i> Continue with Google
        </button>

        <div class="or-divider">
          <span>or</span>
        </div>

        <input type="email" id="login-email" placeholder="Email" class="input-field">
        <input type="password" id="login-password" placeholder="Password" class="input-field">

        <div class="flex justify-between items-center mb-4">
          <label class="flex items-center">
            <input type="checkbox" class="mr-2">
            <span class="text-sm">Remember me</span>
          </label>
          <a href="#" class="text-sm text-mirror-accent">Forgot password?</a>
        </div>

        <button id="login-btn" class="auth-btn">Login</button>

        <div class="face-setup-container">
          <p class="text-sm text-gray-400 mb-2">Want to use face recognition?</p>
          <button id="face-login-btn" class="face-setup-btn">
            <i class="fas fa-camera"></i> Login with Face
          </button>
        </div>
      </div>

      <!-- Signup Form -->
      <div id="signup-form" class="hidden">
        <button id="google-signup" class="social-btn">
          <i class="fab fa-google"></i> Sign up with Google
        </button>

        <div class="or-divider">
          <span>or</span>
        </div>

        <input type="text" id="signup-name" placeholder="Full Name" class="input-field">
        <input type="email" id="signup-email" placeholder="Email" class="input-field">
        <input type="password" id="signup-password" placeholder="Password" class="input-field">
        <input type="password" id="signup-confirm-password" placeholder="Confirm Password" class="input-field">

        <div class="flex items-center mb-4">
          <input type="checkbox" id="terms" class="mr-2">
          <label for="terms" class="text-sm">I agree to the <a href="#" class="text-mirror-accent">Terms of Service</a>
            and <a href="#" class="text-mirror-accent">Privacy Policy</a></label>
        </div>

        <button id="signup-btn" class="auth-btn">Sign Up</button>

        <div class="face-setup-container">
          <p class="text-sm text-gray-400 mb-2">Want to set up face recognition?</p>
          <button id="face-setup-btn" class="face-setup-btn">
            <i class="fas fa-user-plus"></i> Set Up Face Recognition
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Face Recognition Login Modal -->
  <div id="face-login-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
    <div class="bg-mirror-darker p-6 rounded-xl w-full max-w-md border border-mirror-accent">
      <h3 class="text-xl font-semibold mb-4 gradient-text">Face Recognition Login</h3>
      <div id="face-login-webcam-container"
        class="webcam-container relative w-full h-64 bg-black rounded-lg overflow-hidden mb-4">
        <video id="face-login-webcam" class="w-full h-full object-cover" autoplay muted playsinline></video>
        <canvas id="face-login-canvas" class="face-canvas"></canvas>
        <div id="face-login-status" class="camera-status">Initializing camera...</div>
      </div>
      <div class="flex justify-end space-x-3">
        <button id="cancel-face-login"
          class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-all">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Face Setup Modal -->
  <div id="face-setup-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
    <div class="bg-mirror-darker p-6 rounded-xl w-full max-w-md border border-mirror-accent">
      <h3 class="text-xl font-semibold mb-4 gradient-text">Set Up Face Recognition</h3>
      <div id="face-setup-webcam-container"
        class="webcam-container relative w-full h-64 bg-black rounded-lg overflow-hidden mb-4">
        <video id="face-setup-webcam" class="w-full h-full object-cover" autoplay muted playsinline></video>
        <canvas id="face-setup-canvas" class="face-canvas"></canvas>
        <div id="face-setup-status" class="camera-status">Initializing camera...</div>
      </div>
      <p class="text-sm text-gray-400 mb-4">Position your face in the center of the frame and click "Save Face".</p>
      <div class="flex justify-end space-x-3">
        <button id="cancel-face-setup"
          class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-all">Cancel</button>
        <button id="save-face-setup"
          class="px-4 py-2 bg-mirror-accent rounded-lg hover:bg-mirror-accent2 transition-all">Save Face</button>
      </div>
    </div>
  </div>

  <!-- Main App Container (Hidden initially) -->
  <div id="app-container" class="hidden">
    <div class="container mx-auto px-4 py-6">
      <!-- Header with User Profile and Theme Toggle -->
      <header class="flex justify-between items-center mb-6">
        <h1 class="text-4xl font-bold gradient-text">Smart Mirror</h1>
        <div class="flex items-center gap-4">
          <button id="theme-toggle" class="p-3 rounded-full bg-mirror-card text-white hover:glow transition-all">
            <i class="fas fa-sun"></i>
          </button>
          <div class="user-dropdown">
            <button id="user-menu-btn"
              class="flex items-center p-2 rounded-full bg-mirror-card hover:glow transition-all">
              <div id="user-avatar" class="w-8 h-8 rounded-full bg-mirror-accent flex items-center justify-center mr-2">
                <i class="fas fa-user"></i>
              </div>
              <span id="user-name">User</span>
              <i class="fas fa-chevron-down ml-2"></i>
            </button>
            <div id="user-dropdown-menu" class="dropdown-menu">
              <a href="#" class="dropdown-item">
                <i class="fas fa-user-circle"></i> Profile
              </a>
              <a href="#" class="dropdown-item">
                <i class="fas fa-cog"></i> Settings
              </a>
              <a href="#" id="logout-btn" class="dropdown-item">
                <i class="fas fa-sign-out-alt"></i> Logout
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left Column -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Greeting and Time -->
          <div class="mirror-card rounded-xl p-6 gradient-border">
            <h2 id="greeting" class="text-4xl font-light mb-2 gradient-text">Hello, User</h2>
            <div class="flex flex-wrap items-end">
              <div id="time" class="text-6xl font-bold">00:00:00</div>
              <div id="date" class="ml-4 text-xl text-gray-400">Monday, Jan 1</div>
            </div>
          </div>

          <!-- Face Recognition -->
          <div class="mirror-card rounded-xl p-6">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold">Face Recognition</h3>
              <div class="flex items-center">
                <span id="recognition-status" class="text-gray-400 mr-2">Initializing...</span>
                <button id="toggle-webcam"
                  class="p-2 rounded-full bg-mirror-accent text-white hover:glow transition-all">
                  <i class="fas fa-camera"></i>
                </button>
              </div>
            </div>
            <div id="webcam-container"
              class="webcam-container relative w-full h-64 bg-mirror-darker rounded-lg overflow-hidden">
              <video id="webcam" class="w-full h-full object-cover" autoplay muted playsinline></video>
              <canvas id="face-canvas" class="face-canvas"></canvas>
              <div id="camera-status" class="camera-status">Camera inactive</div>
            </div>
            <div class="mt-4 flex justify-between">
              <div id="detected-user" class="text-lg">No user detected</div>
              <button id="add-face"
                class="px-4 py-2 bg-mirror-accent rounded-lg text-white hover:bg-mirror-accent2 transition-all">
                <i class="fas fa-user-plus mr-2"></i>Add New Face
              </button>
            </div>
          </div>

          <!-- Gemini-Powered Insights -->
          <div class="mirror-card rounded-xl p-6">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold gradient-text">AI Insights</h3>
              <button id="refresh-insights"
                class="p-2 rounded-full bg-mirror-accent text-white hover:glow transition-all">
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
            <div class="chart-container mb-4">
              <canvas id="insightsChart"></canvas>
            </div>
            <div id="gemini-insight" class="text-gray-300 text-sm italic">
              Loading AI-powered insights...
            </div>
          </div>

          <!-- Weather Card -->
          <div class="mirror-card rounded-xl p-6">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold">Weather</h3>
              <span id="location" class="text-gray-400">Loading location...</span>
            </div>
            <div class="flex flex-wrap items-center">
              <div id="weather-icon" class="text-5xl mr-4 animate-float">
                <i class="fas fa-cloud"></i>
              </div>
              <div>
                <div id="temperature" class="text-4xl font-bold">--°C</div>
                <div id="weather-description" class="text-gray-400">Loading weather...</div>
              </div>
              <div class="ml-auto">
                <div class="flex items-center mb-2">
                  <i class="fas fa-wind mr-2"></i>
                  <span id="wind-speed">-- km/h</span>
                </div>
                <div class="flex items-center">
                  <i class="fas fa-tint mr-2"></i>
                  <span id="humidity">--%</span>
                </div>
              </div>
            </div>
            <div class="mt-4">
              <h4 class="text-sm font-semibold mb-2">5-Day Forecast</h4>
              <div class="grid grid-cols-5 gap-2">
                <div class="text-center">
                  <div class="text-xs text-gray-400">Mon</div>
                  <div class="text-xl"><i class="fas fa-sun"></i></div>
                  <div class="text-sm">24°</div>
                </div>
                <div class="text-center">
                  <div class="text-xs text-gray-400">Tue</div>
                  <div class="text-xl"><i class="fas fa-cloud-sun"></i></div>
                  <div class="text-sm">22°</div>
                </div>
                <div class="text-center">
                  <div class="text-xs text-gray-400">Wed</div>
                  <div class="text-xl"><i class="fas fa-cloud"></i></div>
                  <div class="text-sm">20°</div>
                </div>
                <div class="text-center">
                  <div class="text-xs text-gray-400">Thu</div>
                  <div class="text-xl"><i class="fas fa-cloud-rain"></i></div>
                  <div class="text-sm">19°</div>
                </div>
                <div class="text-center">
                  <div class="text-xs text-gray-400">Fri</div>
                  <div class="text-xl"><i class="fas fa-cloud-sun"></i></div>
                  <div class="text-sm">21°</div>
                </div>
              </div>
            </div>
          </div>

          <!-- News Headlines -->
          <div class="mirror-card rounded-xl p-6">
            <h3 class="text-xl font-semibold mb-4">Latest News</h3>
            <div id="news-container" class="space-y-4">
              <div class="animate-pulse">
                <div class="h-4 bg-gray-700 rounded w-3/4 mb-2"></div>
                <div class="h-3 bg-gray-700 rounded w-1/2"></div>
              </div>
              <div class="animate-pulse">
                <div class="h-4 bg-gray-700 rounded w-3/4 mb-2"></div>
                <div class="h-3 bg-gray-700 rounded w-1/2"></div>
              </div>
              <div class="animate-pulse">
                <div class="h-4 bg-gray-700 rounded w-3/4 mb-2"></div>
                <div class="h-3 bg-gray-700 rounded w-1/2"></div>
              </div>
            </div>
            <div class="mt-4">
              <div class="chart-container h-32">
                <canvas id="newsSentimentChart"></canvas>
              </div>
              <div class="text-xs text-center text-gray-400 mt-2">News Sentiment Analysis (powered by Gemini)</div>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="space-y-6">
          <!-- Voice Assistant -->
          <div class="mirror-card rounded-xl p-6">
            <h3 class="text-xl font-semibold mb-4 gradient-text">Voice Assistant</h3>
            <div class="flex flex-col items-center">
              <div class="relative">
                <button id="voice-button"
                  class="w-20 h-20 rounded-full bg-mirror-accent flex items-center justify-center mb-4 hover:bg-mirror-accent2 transition-all z-10">
                  <i class="fas fa-microphone text-2xl"></i>
                </button>
                <div class="voice-ripple"></div>
                <div class="voice-ripple" style="animation-delay: 0.5s"></div>
              </div>
              <p id="voice-status" class="text-center text-gray-400">Click to activate voice assistant</p>
            </div>
          </div>

          <!-- Chat Interface -->
          <div class="mirror-card rounded-xl p-6 flex flex-col h-96">
            <h3 class="text-xl font-semibold mb-4">Chat</h3>
            <div id="chat-container" class="chat-container flex-grow space-y-4 mb-4">
              <div class="assistant-message p-3">
                <p>Hello! How can I assist you today?</p>
              </div>
            </div>
            <div class="flex items-center">
              <input id="chat-input" type="text" placeholder="Type your message..."
                class="flex-grow p-3 bg-gray-800 border border-gray-700 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-mirror-accent">
              <button id="send-message"
                class="p-3 bg-mirror-accent rounded-r-lg hover:bg-mirror-accent2 transition-all">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>

          <!-- Smart Home Controls -->
          <div class="mirror-card rounded-xl p-6">
            <h3 class="text-xl font-semibold mb-4 gradient-text">Smart Home</h3>
            <div class="grid grid-cols-2 gap-4">
              <button class="smart-home-button p-4 rounded-lg bg-mirror-card flex flex-col items-center">
                <i class="fas fa-lightbulb text-2xl mb-2"></i>
                <span>Lights</span>
              </button>
              <button class="smart-home-button p-4 rounded-lg bg-mirror-card flex flex-col items-center">
                <i class="fas fa-thermometer-half text-2xl mb-2"></i>
                <span>Thermostat</span>
              </button>
              <button class="smart-home-button p-4 rounded-lg bg-mirror-card flex flex-col items-center">
                <i class="fas fa-lock text-2xl mb-2"></i>
                <span>Security</span>
              </button>
              <button class="smart-home-button p-4 rounded-lg bg-mirror-card flex flex-col items-center">
                <i class="fas fa-music text-2xl mb-2"></i>
                <span>Music</span>
              </button>
            </div>
          </div>

          <!-- Health Metrics -->
          <div class="mirror-card rounded-xl p-6">
            <h3 class="text-xl font-semibold mb-4">Health Metrics</h3>
            <div class="chart-container mb-4">
              <canvas id="healthChart"></canvas>
            </div>
            <div class="grid grid-cols-2 gap-4 mt-4">
              <div class="text-center">
                <div class="text-xs text-gray-400">Steps</div>
                <div class="text-2xl font-bold">8,432</div>
              </div>
              <div class="text-center">
                <div class="text-xs text-gray-400">Sleep</div>
                <div class="text-2xl font-bold">7.2h</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Face Modal -->
      <div id="add-face-modal"
        class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-mirror-darker p-6 rounded-xl w-full max-w-md border border-mirror-accent">
          <h3 class="text-xl font-semibold mb-4 gradient-text">Add New Face</h3>
          <div class="mb-4">
            <label for="user-name" class="block text-sm font-medium mb-2">Name</label>
            <input type="text" id="user-name"
              class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-mirror-accent">
          </div>
          <div class="flex justify-end space-x-3">
            <button id="cancel-add-face"
              class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-all">Cancel</button>
            <button id="save-face"
              class="px-4 py-2 bg-mirror-accent rounded-lg hover:bg-mirror-accent2 transition-all">Save</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentUser = null;
    let recognizedUser = null;
    let users = [];
    let webcamActive = false;
    let faceDetectionInterval = null;
    let isFaceAPILoaded = false;
    let charts = {};
    let faceDetectionEnabled = true;

    // Initialize Particles.js
    document.addEventListener('DOMContentLoaded', async function () {
      particlesJS('particles-js', {
        "particles": {
          "number": {
            "value": 80,
            "density": {
              "enable": true,
              "value_area": 800
            }
          },
          "color": {
            "value": "#6366f1"
          },
          "shape": {
            "type": "circle",
            "stroke": {
              "width": 0,
              "color": "#000000"
            },
            "polygon": {
              "nb_sides": 5
            }
          },
          "opacity": {
            "value": 0.2,
            "random": false,
            "anim": {
              "enable": false,
              "speed": 1,
              "opacity_min": 0.1,
              "sync": false
            }
          },
          "size": {
            "value": 3,
            "random": true,
            "anim": {
              "enable": false,
              "speed": 40,
              "size_min": 0.1,
              "sync": false
            }
          },
          "line_linked": {
            "enable": true,
            "distance": 150,
            "color": "#6366f1",
            "opacity": 0.2,
            "width": 1
          },
          "move": {
            "enable": true,
            "speed": 1,
            "direction": "none",
            "random": false,
            "straight": false,
            "out_mode": "out",
            "bounce": false,
            "attract": {
              "enable": false,
              "rotateX": 600,
              "rotateY": 1200
            }
          }
        },
        "interactivity": {
          "detect_on": "canvas",
          "events": {
            "onhover": {
              "enable": true,
              "mode": "grab"
            },
            "onclick": {
              "enable": true,
              "mode": "push"
            },
            "resize": true
          },
          "modes": {
            "grab": {
              "distance": 140,
              "line_linked": {
                "opacity": 0.5
              }
            },
            "bubble": {
              "distance": 400,
              "size": 40,
              "duration": 2,
              "opacity": 8,
              "speed": 3
            },
            "repulse": {
              "distance": 200,
              "duration": 0.4
            },
            "push": {
              "particles_nb": 4
            },
            "remove": {
              "particles_nb": 2
            }
          }
        },
        "retina_detect": true
      });

      // Load face recognition models
      await loadFaceRecognitionModels();

      // Setup auth tabs
      setupAuthTabs();

      // Setup auth forms
      setupAuthForms();

      // Setup face recognition login
      setupFaceLogin();

      // Setup face recognition setup
      setupFaceSetup();

      // Load saved users
      loadSavedUsers();

      // Check if user is already logged in
      checkLoggedInUser();
    });

    // Load saved users
    function loadSavedUsers() {
      try {
        const savedUsers = localStorage.getItem('smartMirrorUsers');
        if (savedUsers) {
          const parsedUsers = JSON.parse(savedUsers);

          // Convert Array descriptors back to Float32Array
          users = parsedUsers.map(user => ({
            name: user.name,
            email: user.email,
            faceDescriptor: user.faceDescriptor ? new Float32Array(user.faceDescriptor) : null
          }));

          console.log(`Loaded ${users.length} users from storage`);
        }
      } catch (error) {
        console.error('Error loading saved users:', error);
      }
    }

    // Auth Tabs
    function setupAuthTabs() {
      const loginTab = document.getElementById('login-tab');
      const signupTab = document.getElementById('signup-tab');
      const loginForm = document.getElementById('login-form');
      const signupForm = document.getElementById('signup-form');

      loginTab.addEventListener('click', () => {
        loginTab.classList.add('tab-active');
        signupTab.classList.remove('tab-active');
        loginForm.classList.remove('hidden');
        signupForm.classList.add('hidden');
      });

      signupTab.addEventListener('click', () => {
        signupTab.classList.add('tab-active');
        loginTab.classList.remove('tab-active');
        signupForm.classList.remove('hidden');
        loginForm.classList.add('hidden');
      });
    }

    // Auth Forms
    function setupAuthForms() {
      const loginBtn = document.getElementById('login-btn');
      const signupBtn = document.getElementById('signup-btn');
      const googleLoginBtn = document.getElementById('google-login');
      const googleSignupBtn = document.getElementById('google-signup');
      const faceLoginBtn = document.getElementById('face-login-btn');
      const faceSetupBtn = document.getElementById('face-setup-btn');

      // Regular login
      loginBtn.addEventListener('click', () => {
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        if (!email || !password) {
          alert('Please enter both email and password');
          return;
        }

        // Find user by email
        const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());

        if (user) {
          // In a real app, you would validate the password
          loginUser(user);
        } else {
          // Create a new user if not found
          const newUser = {
            name: email.split('@')[0],
            email: email,
            faceDescriptor: null
          };

          users.push(newUser);
          saveUsers();
          loginUser(newUser);
        }
      });

      // Sign up
      signupBtn.addEventListener('click', () => {
        const name = document.getElementById('signup-name').value;
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;
        const confirmPassword = document.getElementById('signup-confirm-password').value;
        const termsChecked = document.getElementById('terms').checked;

        if (!name || !email || !password || !confirmPassword) {
          alert('Please fill in all fields');
          return;
        }

        if (password !== confirmPassword) {
          alert('Passwords do not match');
          return;
        }

        if (!termsChecked) {
          alert('Please agree to the Terms of Service and Privacy Policy');
          return;
        }

        // Check if user already exists
        const existingUser = users.find(u => u.email.toLowerCase() === email.toLowerCase());

        if (existingUser) {
          alert('An account with this email already exists');
          return;
        }

        // Create new user
        const newUser = {
          name: name,
          email: email,
          faceDescriptor: null
        };

        // Add user to our local array
        users.push(newUser);
        saveUsers();

        // Login the user
        loginUser(newUser);
      });

      // Google login
      googleLoginBtn.addEventListener('click', () => {
        // In a real app, you would use the Google Sign-In API
        // For this demo, we'll simulate a successful Google login
        loginUser({
          name: 'Google User',
          email: 'google.user@example.com',
          faceDescriptor: null
        });
      });

      // Google signup
      googleSignupBtn.addEventListener('click', () => {
        // In a real app, you would use the Google Sign-In API
        // For this demo, we'll simulate a successful Google signup
        loginUser({
          name: 'Google User',
          email: 'google.user@example.com',
          faceDescriptor: null
        });
      });

      // Face login
      faceLoginBtn.addEventListener('click', () => {
        document.getElementById('face-login-modal').classList.remove('hidden');
        startFaceLoginWebcam();
      });

      // Face setup
      faceSetupBtn.addEventListener('click', () => {
        document.getElementById('face-setup-modal').classList.remove('hidden');
        startFaceSetupWebcam();
      });
    }

    // Save users to localStorage
    function saveUsers() {
      try {
        localStorage.setItem('smartMirrorUsers', JSON.stringify(users.map(user => ({
          name: user.name,
          email: user.email,
          // Convert Float32Array to Array for storage
          faceDescriptor: user.faceDescriptor ? Array.from(user.faceDescriptor) : null
        }))));
      } catch (error) {
        console.error('Error saving users:', error);
      }
    }

    // Face Recognition
    async function loadFaceRecognitionModels() {
      try {
        const statusElement = document.getElementById('recognition-status');
        if (statusElement) {
          statusElement.textContent = 'Loading face models...';
        }

        await faceapi.nets.ssdMobilenetv1.loadFromUri('https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights');
        await faceapi.nets.faceLandmark68Net.loadFromUri('https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights');
        await faceapi.nets.faceRecognitionNet.loadFromUri('https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights');

        isFaceAPILoaded = true;
        console.log('Face API models loaded successfully');

        if (statusElement) {
          statusElement.textContent = 'Face models loaded';
        }
      } catch (error) {
        console.error('Error loading face recognition models:', error);
        const statusElement = document.getElementById('recognition-status');
        if (statusElement) {
          statusElement.textContent = 'Error loading face models';
        }
      }
    }

    // Face Recognition Login
    function setupFaceLogin() {
      const cancelFaceLoginBtn = document.getElementById('cancel-face-login');

      cancelFaceLoginBtn.addEventListener('click', () => {
        document.getElementById('face-login-modal').classList.add('hidden');
        stopFaceLoginWebcam();
      });
    }

    // Start Face Login Webcam
    async function startFaceLoginWebcam() {
      const video = document.getElementById('face-login-webcam');
      const canvas = document.getElementById('face-login-canvas');
      const statusElement = document.getElementById('face-login-status');

      if (!isFaceAPILoaded) {
        statusElement.textContent = 'Face recognition not ready. Please try again later.';
        return;
      }

      try {
        statusElement.textContent = 'Requesting camera access...';

        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: 'user',
            width: { ideal: 640 },
            height: { ideal: 480 }
          }
        });

        video.srcObject = stream;

        // Wait for video to be ready
        await new Promise(resolve => {
          video.onloadedmetadata = () => {
            resolve();
          };
        });

        // Start playing the video
        await video.play();

        // Set canvas dimensions to match video
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        statusElement.textContent = 'Looking for your face...';

        // Start face detection
        const faceLoginInterval = setInterval(async () => {
          if (!video.paused && !video.ended) {
            try {
              // Detect all faces in the video
              const detections = await faceapi.detectAllFaces(video)
                .withFaceLandmarks()
                .withFaceDescriptors();

              // Clear previous drawings
              const context = canvas.getContext('2d');
              context.clearRect(0, 0, canvas.width, canvas.height);

              // Draw detections
              const displaySize = { width: video.videoWidth, height: video.videoHeight };
              const resizedDetections = faceapi.resizeResults(detections, displaySize);

              // Draw face detections
              resizedDetections.forEach(detection => {
                const box = detection.detection.box;

                // Draw rectangle around face
                context.strokeStyle = '#6366f1';
                context.lineWidth = 2;
                context.strokeRect(box.x, box.y, box.width, box.height);

                // Add a glowing effect
                context.shadowColor = '#6366f1';
                context.shadowBlur = 15;
                context.strokeStyle = 'rgba(99, 102, 241, 0.5)';
                context.strokeRect(box.x, box.y, box.width, box.height);
                context.shadowBlur = 0;
              });

              // Recognize faces
              if (detections.length > 0) {
                statusElement.textContent = 'Face detected, trying to recognize...';

                // Get the first detected face
                const faceDescriptor = detections[0].descriptor;

                // Compare with known faces
                let matchedUser = null;
                let minDistance = 0.6; // Threshold for face recognition

                users.forEach(user => {
                  if (user.faceDescriptor) {
                    const distance = faceapi.euclideanDistance(faceDescriptor, user.faceDescriptor);
                    if (distance < minDistance) {
                      minDistance = distance;
                      matchedUser = user;
                    }
                  }
                });

                if (matchedUser) {
                  statusElement.textContent = `Welcome back, ${matchedUser.name}!`;

                  // Stop the interval and webcam
                  clearInterval(faceLoginInterval);

                  // Login the user after a short delay
                  setTimeout(() => {
                    stopFaceLoginWebcam();
                    document.getElementById('face-login-modal').classList.add('hidden');
                    loginUser(matchedUser);
                  }, 1000);
                } else {
                  statusElement.textContent = 'Face not recognized. Please try again or use email login.';
                }
              } else {
                statusElement.textContent = 'Looking for your face...';
              }
            } catch (error) {
              console.error('Error in face login detection:', error);
              statusElement.textContent = 'Detection error. Please try again.';
            }
          }
        }, 100);

        // Store the interval ID to clear it later
        video.dataset.intervalId = faceLoginInterval;

      } catch (error) {
        console.error('Error accessing webcam:', error);
        statusElement.innerHTML = `
                    <div class="camera-permission-error">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Camera access denied. Please check your browser permissions.
                    </div>
                `;
      }
    }

    // Stop Face Login Webcam
    function stopFaceLoginWebcam() {
      const video = document.getElementById('face-login-webcam');
      const stream = video.srcObject;

      if (stream) {
        const tracks = stream.getTracks();
        tracks.forEach(track => track.stop());
        video.srcObject = null;
      }

      // Clear the detection interval
      if (video.dataset.intervalId) {
        clearInterval(parseInt(video.dataset.intervalId));
        delete video.dataset.intervalId;
      }
    }

    // Face Recognition Setup
    function setupFaceSetup() {
      const cancelFaceSetupBtn = document.getElementById('cancel-face-setup');
      const saveFaceSetupBtn = document.getElementById('save-face-setup');

      cancelFaceSetupBtn.addEventListener('click', () => {
        document.getElementById('face-setup-modal').classList.add('hidden');
        stopFaceSetupWebcam();
      });

      saveFaceSetupBtn.addEventListener('click', async () => {
        const video = document.getElementById('face-setup-webcam');
        const statusElement = document.getElementById('face-setup-status');

        try {
          statusElement.textContent = 'Processing...';
          saveFaceSetupBtn.disabled = true;

          // Detect face in the video
          const detection = await faceapi.detectSingleFace(video)
            .withFaceLandmarks()
            .withFaceDescriptor();

          if (detection) {
            // Get the name from the signup form
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;

            if (!name || !email) {
              alert('Please fill in your name and email in the signup form first');
              statusElement.textContent = 'Ready';
              saveFaceSetupBtn.disabled = false;
              return;
            }

            // Create a new user with face descriptor
            const newUser = {
              name: name,
              email: email,
              faceDescriptor: detection.descriptor
            };

            // Add user to our local array
            users.push(newUser);
            saveUsers();

            // Close the modal
            document.getElementById('face-setup-modal').classList.add('hidden');
            stopFaceSetupWebcam();

            alert('Face recognition setup complete! You can now login with your face.');
          } else {
            alert('No face detected. Please make sure your face is clearly visible.');
            statusElement.textContent = 'No face detected. Please try again.';
            saveFaceSetupBtn.disabled = false;
          }
        } catch (error) {
          console.error('Error in face setup:', error);
          alert('Error setting up face recognition. Please try again.');
          statusElement.textContent = 'Error. Please try again.';
          saveFaceSetupBtn.disabled = false;
        }
      });
    }

    // Start Face Setup Webcam
    async function startFaceSetupWebcam() {
      const video = document.getElementById('face-setup-webcam');
      const canvas = document.getElementById('face-setup-canvas');
      const statusElement = document.getElementById('face-setup-status');

      if (!isFaceAPILoaded) {
        statusElement.textContent = 'Face recognition not ready. Please try again later.';
        return;
      }

      try {
        statusElement.textContent = 'Requesting camera access...';

        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: 'user',
            width: { ideal: 640 },
            height: { ideal: 480 }
          }
        });

        video.srcObject = stream;

        // Wait for video to be ready
        await new Promise(resolve => {
          video.onloadedmetadata = () => {
            resolve();
          };
        });

        // Start playing the video
        await video.play();

        // Set canvas dimensions to match video
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        statusElement.textContent = 'Position your face in the center';

        // Start face detection
        const faceSetupInterval = setInterval(async () => {
          if (!video.paused && !video.ended) {
            try {
              // Detect all faces in the video
              const detections = await faceapi.detectAllFaces(video)
                .withFaceLandmarks();

              // Clear previous drawings
              const context = canvas.getContext('2d');
              context.clearRect(0, 0, canvas.width, canvas.height);

              // Draw detections
              const displaySize = { width: video.videoWidth, height: video.videoHeight };
              const resizedDetections = faceapi.resizeResults(detections, displaySize);

              // Draw face detections
              resizedDetections.forEach(detection => {
                const box = detection.detection.box;

                // Draw rectangle around face
                context.strokeStyle = '#6366f1';
                context.lineWidth = 2;
                context.strokeRect(box.x, box.y, box.width, box.height);

                // Add a glowing effect
                context.shadowColor = '#6366f1';
                context.shadowBlur = 15;
                context.strokeStyle = 'rgba(99, 102, 241, 0.5)';
                context.strokeRect(box.x, box.y, box.width, box.height);
                context.shadowBlur = 0;
              });

              if (detections.length > 0) {
                statusElement.textContent = 'Face detected! Click "Save Face" when ready.';
              } else {
                statusElement.textContent = 'No face detected. Please position your face in the center.';
              }
            } catch (error) {
              console.error('Error in face setup detection:', error);
              statusElement.textContent = 'Detection error. Please try again.';
            }
          }
        }, 100);

        // Store the interval ID to clear it later
        video.dataset.intervalId = faceSetupInterval;

      } catch (error) {
        console.error('Error accessing webcam:', error);
        statusElement.innerHTML = `
                    <div class="camera-permission-error">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Camera access denied. Please check your browser permissions.
                    </div>
                `;
      }
    }

    // Stop Face Setup Webcam
    function stopFaceSetupWebcam() {
      const video = document.getElementById('face-setup-webcam');
      const stream = video.srcObject;

      if (stream) {
        const tracks = stream.getTracks();
        tracks.forEach(track => track.stop());
        video.srcObject = null;
      }

      // Clear the detection interval
      if (video.dataset.intervalId) {
        clearInterval(parseInt(video.dataset.intervalId));
        delete video.dataset.intervalId;
      }
    }

    // Check if user is already logged in
    function checkLoggedInUser() {
      // In a real app, you would check for a token in localStorage or cookies
      const savedUser = localStorage.getItem('smartMirrorUser');

      if (savedUser) {
        try {
          const user = JSON.parse(savedUser);
          loginUser(user, false);
        } catch (error) {
          console.error('Error parsing saved user:', error);
        }
      }
    }

    // Login user
    function loginUser(user, saveUser = true) {
      currentUser = user;

      // Update UI
      document.getElementById('auth-container').classList.add('hidden');
      document.getElementById('app-container').classList.remove('hidden');

      // Update user name in header
      document.getElementById('user-name').textContent = user.name;

      // Update greeting
      updateGreeting(new Date().getHours());

      // Save user to localStorage
      if (saveUser) {
        localStorage.setItem('smartMirrorUser', JSON.stringify(user));
      }

      // Initialize app features
      initializeAppFeatures();
    }

    // Logout user
    function logoutUser() {
      currentUser = null;
      recognizedUser = null;

      // Update UI
      document.getElementById('app-container').classList.add('hidden');
      document.getElementById('auth-container').classList.remove('hidden');

      // Clear localStorage
      localStorage.removeItem('smartMirrorUser');

      // Stop webcam if active
      if (webcamActive) {
        stopWebcam();
      }
    }

    // Initialize app features
    function initializeAppFeatures() {
      // Setup user dropdown
      setupUserDropdown();

      // Setup webcam
      setupWebcam();

      // Setup add face functionality
      setupAddFace();

      // Fetch weather data
      fetchWeather();
      // Refresh weather every 30 minutes
      setInterval(fetchWeather, 30 * 60 * 1000);

      // Fetch news
      fetchNews();
      // Refresh news every hour
      setInterval(fetchNews, 60 * 60 * 1000);

      // Setup voice assistant
      setupVoiceAssistant();

      // Setup chat interface
      setupChatInterface();

      // Setup smart home controls
      setupSmartHomeControls();

      // Setup refresh insights button
      setupRefreshInsights();

      // Initialize charts
      fetchGeminiInsights();
      updateHealthChart();

      // Setup theme toggle
      setupThemeToggle();

      // Start clock
      updateClock();
      setInterval(updateClock, 1000);
    }

    // Setup user dropdown
    function setupUserDropdown() {
      const userMenuBtn = document.getElementById('user-menu-btn');
      const userDropdownMenu = document.getElementById('user-dropdown-menu');
      const logoutBtn = document.getElementById('logout-btn');

      userMenuBtn.addEventListener('click', () => {
        userDropdownMenu.classList.toggle('show');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', (event) => {
        if (!userMenuBtn.contains(event.target) && !userDropdownMenu.contains(event.target)) {
          userDropdownMenu.classList.remove('show');
        }
      });

      // Logout button
      logoutBtn.addEventListener('click', (event) => {
        event.preventDefault();
        logoutUser();
      });
    }

    // Setup webcam with improved error handling
    function setupWebcam() {
      const video = document.getElementById('webcam');
      const toggleWebcamBtn = document.getElementById('toggle-webcam');
      const statusElement = document.getElementById('recognition-status');
      const cameraStatusElement = document.getElementById('camera-status');

      toggleWebcamBtn.addEventListener('click', () => {
        if (webcamActive) {
          stopWebcam();
        } else {
          startWebcam();
        }
      });

      async function startWebcam() {
        if (!isFaceAPILoaded) {
          statusElement.textContent = 'Face recognition not ready';
          cameraStatusElement.textContent = 'Face models not loaded';
          return;
        }

        try {
          statusElement.textContent = 'Requesting camera...';
          cameraStatusElement.textContent = 'Requesting camera access...';
          cameraStatusElement.classList.add('bg-yellow-600');

          const constraints = {
            video: {
              facingMode: 'user',
              width: { ideal: 640 },
              height: { ideal: 480 }
            }
          };

          const stream = await navigator.mediaDevices.getUserMedia(constraints);
          video.srcObject = stream;

          // Wait for video to be ready
          await new Promise(resolve => {
            video.onloadedmetadata = () => {
              resolve();
            };
          });

          // Start playing the video
          await video.play();

          webcamActive = true;
          toggleWebcamBtn.innerHTML = '<i class="fas fa-camera-slash"></i>';
          statusElement.textContent = 'Camera active';
          cameraStatusElement.textContent = 'Camera active';
          cameraStatusElement.classList.remove('bg-yellow-600');
          cameraStatusElement.classList.add('bg-green-600');

          // Set canvas dimensions to match video
          const canvas = document.getElementById('face-canvas');
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;

          // Start face detection
          startFaceDetection();

        } catch (error) {
          console.error('Error accessing webcam:', error);
          statusElement.textContent = 'Camera access denied';

          // Show error message in camera container
          const webcamContainer = document.getElementById('webcam-container');
          const errorDiv = document.createElement('div');
          errorDiv.className = 'camera-permission-error';
          errorDiv.innerHTML = `
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Camera access denied. Please check your browser permissions.
                    `;
          webcamContainer.appendChild(errorDiv);

          cameraStatusElement.textContent = 'Camera access denied';
          cameraStatusElement.classList.remove('bg-yellow-600');
          cameraStatusElement.classList.add('bg-red-600');
        }
      }

      function stopWebcam() {
        const stream = video.srcObject;
        if (stream) {
          const tracks = stream.getTracks();
          tracks.forEach(track => track.stop());
          video.srcObject = null;
        }

        webcamActive = false;
        toggleWebcamBtn.innerHTML = '<i class="fas fa-camera"></i>';
        statusElement.textContent = 'Camera inactive';
        cameraStatusElement.textContent = 'Camera inactive';
        cameraStatusElement.classList.remove('bg-green-600', 'bg-red-600', 'bg-yellow-600');

        // Remove any error messages
        const errorElements = document.querySelectorAll('.camera-permission-error');
        errorElements.forEach(el => el.remove());

        // Stop face detection
        if (faceDetectionInterval) {
          clearInterval(faceDetectionInterval);
          faceDetectionInterval = null;
        }

        // Clear canvas
        const canvas = document.getElementById('face-canvas');
        const context = canvas.getContext('2d');
        context.clearRect(0, 0, canvas.width, canvas.height);

        // Reset user detection
        document.getElementById('detected-user').textContent = 'No user detected';
        recognizedUser = null;
        updateGreeting(new Date().getHours());
      }
    }

    // Start face detection with improved performance
    function startFaceDetection() {
      if (!isFaceAPILoaded || !webcamActive) {
        console.error('Face API not loaded or webcam not active');
        return;
      }

      const video = document.getElementById('webcam');
      const canvas = document.getElementById('face-canvas');
      const detectedUserElement = document.getElementById('detected-user');
      const statusElement = document.getElementById('recognition-status');
      const cameraStatusElement = document.getElementById('camera-status');

      // Clear any existing interval
      if (faceDetectionInterval) {
        clearInterval(faceDetectionInterval);
      }

      // Use a more efficient detection interval (200ms instead of 100ms)
      faceDetectionInterval = setInterval(async () => {
        if (!webcamActive || !faceDetectionEnabled) return;

        try {
          // Temporarily disable face detection during processing to prevent overlapping detections
          faceDetectionEnabled = false;

          // Detect all faces in the video
          const detections = await faceapi.detectAllFaces(video)
            .withFaceLandmarks()
            .withFaceDescriptors();

          // Clear previous drawings
          const context = canvas.getContext('2d');
          context.clearRect(0, 0, canvas.width, canvas.height);

          // Draw detections
          if (detections.length > 0) {
            const displaySize = { width: video.videoWidth, height: video.videoHeight };
            const resizedDetections = faceapi.resizeResults(detections, displaySize);

            // Draw face detections
            resizedDetections.forEach(detection => {
              const box = detection.detection.box;

              // Draw rectangle around face
              context.strokeStyle = '#6366f1';
              context.lineWidth = 2;
              context.strokeRect(box.x, box.y, box.width, box.height);

              // Add a glowing effect
              context.shadowColor = '#6366f1';
              context.shadowBlur = 15;
              context.strokeStyle = 'rgba(99, 102, 241, 0.5)';
              context.strokeRect(box.x, box.y, box.width, box.height);
              context.shadowBlur = 0;
            });

            // Recognize faces
            statusElement.textContent = 'Face detected';
            cameraStatusElement.textContent = 'Face detected';

            // Get the first detected face
            const faceDescriptor = detections[0].descriptor;

            // Compare with known faces
            let matchedUser = null;
            let minDistance = 0.6; // Threshold for face recognition

            users.forEach(user => {
              if (user.faceDescriptor) {
                const distance = faceapi.euclideanDistance(faceDescriptor, user.faceDescriptor);
                if (distance < minDistance) {
                  minDistance = distance;
                  matchedUser = user.name;
                }
              }
            });

            if (matchedUser) {
              detectedUserElement.textContent = `Recognized: ${matchedUser}`;

              // Only update and speak if this is a new recognition
              if (recognizedUser !== matchedUser) {
                recognizedUser = matchedUser;
                updateGreeting(new Date().getHours());

                // Speak greeting
                const greeting = document.getElementById('greeting').textContent;
                speakText(greeting);
              }
            } else {
              detectedUserElement.textContent = 'Unknown user';

              // Only update if previously recognized someone else
              if (recognizedUser !== null) {
                recognizedUser = null;
                updateGreeting(new Date().getHours());
              }
            }
          } else {
            statusElement.textContent = 'No face detected';
            cameraStatusElement.textContent = 'No face detected';
            detectedUserElement.textContent = 'No user detected';

            // Only update if previously recognized someone
            if (recognizedUser !== null) {
              recognizedUser = null;
              updateGreeting(new Date().getHours());
            }
          }

          // Re-enable face detection
          faceDetectionEnabled = true;
        } catch (error) {
          console.error('Error in face detection:', error);
          statusElement.textContent = 'Detection error';
          cameraStatusElement.textContent = 'Detection error';

          // Re-enable face detection
          faceDetectionEnabled = true;
        }
      }, 200); // Reduced from 100ms to 200ms for better performance
    }

    // Add new face with improved UI feedback
    function setupAddFace() {
      const addFaceBtn = document.getElementById('add-face');
      const modal = document.getElementById('add-face-modal');
      const cancelBtn = document.getElementById('cancel-add-face');
      const saveBtn = document.getElementById('save-face');
      const nameInput = document.getElementById('user-name');

      addFaceBtn.addEventListener('click', () => {
        if (!webcamActive) {
          alert('Please activate the camera first');
          return;
        }

        if (!isFaceAPILoaded) {
          alert('Face recognition is not ready yet. Please try again later.');
          return;
        }

        modal.classList.remove('hidden');
        nameInput.value = '';
        nameInput.focus();
      });

      cancelBtn.addEventListener('click', () => {
        modal.classList.add('hidden');
      });

      saveBtn.addEventListener('click', async () => {
        const name = nameInput.value.trim();
        if (!name) {
          alert('Please enter a name');
          return;
        }

        // Disable button to prevent multiple clicks
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<div class="loading-spinner"></div> Saving...';

        try {
          const video = document.getElementById('webcam');
          const detections = await faceapi.detectSingleFace(video)
            .withFaceLandmarks()
            .withFaceDescriptor();

          if (detections) {
            // Add new user or update existing
            const existingUserIndex = users.findIndex(user => user.name.toLowerCase() === name.toLowerCase());

            if (existingUserIndex !== -1) {
              users[existingUserIndex].faceDescriptor = detections.descriptor;
            } else {
              users.push({
                name: name,
                email: `${name.toLowerCase().replace(/\s+/g, '.')}@example.com`,
                faceDescriptor: detections.descriptor
              });
            }

            // Save to localStorage
            saveUsers();

            alert(`Face for ${name} has been saved!`);
            modal.classList.add('hidden');

            // Update recognized user
            recognizedUser = name;
            updateGreeting(new Date().getHours());
            document.getElementById('detected-user').textContent = `Recognized: ${name}`;

            // Speak welcome message
            speakText(`Welcome, ${name}! I've added your face to my database.`);
          } else {
            alert('No face detected. Please make sure your face is clearly visible and try again.');
          }
        } catch (error) {
          console.error('Error saving face:', error);
          alert('Error saving face. Please try again.');
        } finally {
          // Re-enable button
          saveBtn.disabled = false;
          saveBtn.innerHTML = 'Save';
        }
      });
    }

    // Clock and Date
    function updateClock() {
      const now = new Date();
      const timeElement = document.getElementById('time');
      const dateElement = document.getElementById('date');

      // Update time
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const seconds = now.getSeconds().toString().padStart(2, '0');
      timeElement.textContent = `${hours}:${minutes}:${seconds}`;

      // Update date
      const options = { weekday: 'long', month: 'short', day: 'numeric' };
      dateElement.textContent = now.toLocaleDateString('en-US', options);

      // Update greeting based on time and recognized user
      updateGreeting(now.getHours());
    }

    function updateGreeting(hour) {
      const greetingElement = document.getElementById('greeting');
      let greeting = 'Good morning';

      if (hour >= 12 && hour < 18) {
        greeting = 'Good afternoon';
      } else if (hour >= 18) {
        greeting = 'Good evening';
      }

      // Use recognized user if available, otherwise use logged in user
      const displayName = recognizedUser || (currentUser ? currentUser.name : 'User');
      greetingElement.textContent = `${greeting}, ${displayName}!`;
    }

    // Theme Toggle
    function setupThemeToggle() {
      const themeToggle = document.getElementById('theme-toggle');
      const body = document.body;
      const themeIcon = themeToggle.querySelector('i');

      themeToggle.addEventListener('click', () => {
        if (body.classList.contains('dark')) {
          body.classList.remove('dark');
          body.classList.add('bg-mirror-light', 'text-gray-800');
          body.classList.remove('bg-mirror-dark', 'text-white');
          themeIcon.classList.remove('fa-sun');
          themeIcon.classList.add('fa-moon');
        } else {
          body.classList.add('dark');
          body.classList.add('bg-mirror-dark', 'text-white');
          body.classList.remove('bg-mirror-light', 'text-gray-800');
          themeIcon.classList.remove('fa-moon');
          themeIcon.classList.add('fa-sun');
        }
      });
    }

    // Weather API with error handling
    async function fetchWeather() {
      try {
        // For demo purposes, use mock data instead of API call
        // In a real app, you would use your OpenWeather API key
        // const apiKey = 'YOUR_OPENWEATHER_API_KEY';
        // const city = 'London';
        // const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${apiKey}`);
        // const data = await response.json();

        // Mock weather data
        const data = {
          name: 'London',
          main: {
            temp: 22,
            humidity: 65
          },
          weather: [
            {
              description: 'partly cloudy',
              icon: '02d'
            }
          ],
          wind: {
            speed: 5.2
          },
          sys: {
            sunrise: new Date().setHours(6, 0, 0, 0) / 1000,
            sunset: new Date().setHours(20, 0, 0, 0) / 1000
          }
        };

        // Update weather information
        document.getElementById('location').textContent = data.name;
        document.getElementById('temperature').textContent = `${Math.round(data.main.temp)}°C`;
        document.getElementById('weather-description').textContent = data.weather[0].description;
        document.getElementById('wind-speed').textContent = `${Math.round(data.wind.speed * 3.6)} km/h`; // Convert m/s to km/h
        document.getElementById('humidity').textContent = `${data.main.humidity}%`;

        // Update weather icon
        const weatherIcon = document.getElementById('weather-icon');
        const iconCode = data.weather[0].icon;

        // Map OpenWeather icon codes to Font Awesome icons
        const iconMap = {
          '01d': 'fa-sun',
          '01n': 'fa-moon',
          '02d': 'fa-cloud-sun',
          '02n': 'fa-cloud-moon',
          '03d': 'fa-cloud',
          '03n': 'fa-cloud',
          '04d': 'fa-cloud',
          '04n': 'fa-cloud',
          '09d': 'fa-cloud-showers-heavy',
          '09n': 'fa-cloud-showers-heavy',
          '10d': 'fa-cloud-rain',
          '10n': 'fa-cloud-rain',
          '11d': 'fa-bolt',
          '11n': 'fa-bolt',
          '13d': 'fa-snowflake',
          '13n': 'fa-snowflake',
          '50d': 'fa-smog',
          '50n': 'fa-smog'
        };

        weatherIcon.innerHTML = `<i class="fas ${iconMap[iconCode] || 'fa-cloud'}"></i>`;

      } catch (error) {
        console.error('Error fetching weather data:', error);
        document.getElementById('weather-description').textContent = 'Unable to fetch weather data';
      }
    }

    // News API with error handling
    async function fetchNews() {
      try {
        // For demo purposes, use mock data instead of API call
        // In a real app, you would use your News API key
        // const apiKey = 'YOUR_NEWSAPI_KEY';
        // const response = await fetch(`https://newsapi.org/v2/top-headlines?country=us&apiKey=${apiKey}`);
        // const data = await response.json();

        // Mock news data
        const data = {
          articles: [
            {
              title: 'New AI breakthrough helps smart mirrors recognize users better',
              source: { name: 'Tech Daily' },
              publishedAt: new Date().toISOString()
            },
            {
              title: 'Smart home technology adoption continues to rise worldwide',
              source: { name: 'Home Tech Review' },
              publishedAt: new Date().toISOString()
            },
            {
              title: 'Weather forecasting gets more accurate with new satellite data',
              source: { name: 'Science Today' },
              publishedAt: new Date().toISOString()
            },
            {
              title: 'Health tracking devices show promising results in early detection',
              source: { name: 'Health Weekly' },
              publishedAt: new Date().toISOString()
            },
            {
              title: 'Voice assistants becoming more natural in conversations',
              source: { name: 'AI Insider' },
              publishedAt: new Date().toISOString()
            }
          ]
        };

        const newsContainer = document.getElementById('news-container');
        newsContainer.innerHTML = '';

        // Display top 5 news headlines
        const articles = data.articles.slice(0, 5);
        articles.forEach(article => {
          const newsItem = document.createElement('div');
          newsItem.className = 'border-b border-gray-700 pb-3 mb-3 last:border-0 last:mb-0 last:pb-0';

          newsItem.innerHTML = `
                        <h4 class="font-medium mb-1">${article.title}</h4>
                        <p class="text-sm text-gray-400">${article.source.name} • ${new Date(article.publishedAt).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</p>
                    `;

          newsContainer.appendChild(newsItem);
        });

        // Update news sentiment chart
        updateNewsSentimentChart(articles);

      } catch (error) {
        console.error('Error fetching news data:', error);
        const newsContainer = document.getElementById('news-container');
        newsContainer.innerHTML = '<p class="text-gray-400">Unable to fetch news headlines</p>';
      }
    }

    // Gemini API for insights
    async function fetchGeminiInsights() {
      try {
        // In a real implementation, you would call the Gemini API here
        // For this demo, we'll simulate a response

        // Simulate API call delay
        await new Promise(resolve => setTimeout(resolve, 1000));

        // Sample insights data (in a real app, this would come from Gemini API)
        const insightData = {
          productivity: [65, 72, 78, 68, 82, 75, 70],
          focus: [60, 65, 70, 72, 75, 68, 73],
          energy: [80, 75, 65, 70, 72, 78, 82],
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          insight: `Based on your activity patterns, ${currentUser ? currentUser.name : 'you'} tend to be most productive on Fridays. Consider scheduling important tasks for that day. Your energy levels are highest in the mornings, making it an ideal time for creative work.`
        };

        // Update the insight text
        document.getElementById('gemini-insight').textContent = insightData.insight;

        // Update the insights chart
        updateInsightsChart(insightData);

      } catch (error) {
        console.error('Error fetching Gemini insights:', error);
        document.getElementById('gemini-insight').textContent = 'Unable to fetch AI insights at this time.';
      }
    }

    // Update insights chart
    function updateInsightsChart(data) {
      const ctx = document.getElementById('insightsChart').getContext('2d');

      // Destroy existing chart if it exists
      if (charts.insights) {
        charts.insights.destroy();
      }

      // Create new chart
      charts.insights = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [
            {
              label: 'Productivity',
              data: data.productivity,
              borderColor: '#6366f1',
              backgroundColor: 'rgba(99, 102, 241, 0.1)',
              tension: 0.4,
              fill: true
            },
            {
              label: 'Focus',
              data: data.focus,
              borderColor: '#8b5cf6',
              backgroundColor: 'rgba(139, 92, 246, 0.1)',
              tension: 0.4,
              fill: true
            },
            {
              label: 'Energy',
              data: data.energy,
              borderColor: '#ec4899',
              backgroundColor: 'rgba(236, 72, 153, 0.1)',
              tension: 0.4,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            },
            tooltip: {
              mode: 'index',
              intersect: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            },
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            }
          }
        }
      });
    }

    // Update news sentiment chart
    function updateNewsSentimentChart(articles) {
      const ctx = document.getElementById('newsSentimentChart').getContext('2d');

      // In a real app, you would analyze sentiment with Gemini API
      // For this demo, we'll generate random sentiment scores
      const sentimentScores = articles.slice(0, 5).map(() => {
        return {
          positive: Math.random() * 0.7 + 0.3, // 0.3 to 1.0
          negative: Math.random() * 0.3, // 0 to 0.3
          neutral: Math.random() * 0.4 // 0 to 0.4
        };
      });

      const positiveData = sentimentScores.map(score => score.positive * 100);
      const negativeData = sentimentScores.map(score => score.negative * 100);
      const neutralData = sentimentScores.map(score => score.neutral * 100);

      // Destroy existing chart if it exists
      if (charts.newsSentiment) {
        charts.newsSentiment.destroy();
      }

      // Create new chart
      charts.newsSentiment = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: articles.slice(0, 5).map((article, index) => `News ${index + 1}`),
          datasets: [
            {
              label: 'Positive',
              data: positiveData,
              backgroundColor: 'rgba(34, 197, 94, 0.7)',
              borderColor: 'rgba(34, 197, 94, 1)',
              borderWidth: 1
            },
            {
              label: 'Neutral',
              data: neutralData,
              backgroundColor: 'rgba(99, 102, 241, 0.7)',
              borderColor: 'rgba(99, 102, 241, 1)',
              borderWidth: 1
            },
            {
              label: 'Negative',
              data: negativeData,
              backgroundColor: 'rgba(239, 68, 68, 0.7)',
              borderColor: 'rgba(239, 68, 68, 1)',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: 'rgba(255, 255, 255, 0.7)',
                font: {
                  size: 10
                }
              }
            },
            tooltip: {
              mode: 'index',
              intersect: false
            }
          },
          scales: {
            y: {
              stacked: true,
              beginAtZero: true,
              max: 100,
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)',
                font: {
                  size: 10
                }
              }
            },
            x: {
              stacked: true,
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)',
                font: {
                  size: 10
                }
              }
            }
          }
        }
      });
    }

    // Update health chart
    function updateHealthChart() {
      const ctx = document.getElementById('healthChart').getContext('2d');

      // Sample health data (in a real app, this would come from a health API or device)
      const healthData = {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        steps: [6500, 8200, 7800, 9100, 8400, 10200, 8432],
        sleep: [6.8, 7.2, 6.5, 7.8, 7.0, 8.5, 7.2]
      };

      // Destroy existing chart if it exists
      if (charts.health) {
        charts.health.destroy();
      }

      // Create new chart
      charts.health = new Chart(ctx, {
        type: 'line',
        data: {
          labels: healthData.labels,
          datasets: [
            {
              label: 'Steps',
              data: healthData.steps,
              borderColor: '#6366f1',
              backgroundColor: 'rgba(99, 102, 241, 0.1)',
              tension: 0.4,
              fill: true,
              yAxisID: 'y'
            },
            {
              label: 'Sleep (hours)',
              data: healthData.sleep,
              borderColor: '#8b5cf6',
              backgroundColor: 'rgba(139, 92, 246, 0.1)',
              tension: 0.4,
              fill: true,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            },
            tooltip: {
              mode: 'index',
              intersect: false
            }
          },
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              beginAtZero: true,
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              beginAtZero: true,
              max: 10,
              grid: {
                drawOnChartArea: false
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            },
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            }
          }
        }
      });
    }

    // Setup refresh insights button
    function setupRefreshInsights() {
      const refreshButton = document.getElementById('refresh-insights');

      refreshButton.addEventListener('click', () => {
        // Show loading state
        document.getElementById('gemini-insight').textContent = 'Analyzing your data with Gemini AI...';

        // Fetch new insights
        fetchGeminiInsights();
      });
    }

    // Voice Assistant
    function setupVoiceAssistant() {
      const voiceButton = document.getElementById('voice-button');
      const voiceStatus = document.getElementById('voice-status');

      // Check if browser supports speech recognition
      if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();

        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        let isListening = false;

        voiceButton.addEventListener('click', () => {
          if (!isListening) {
            // Start listening
            recognition.start();
            voiceStatus.textContent = 'Listening...';
            voiceButton.classList.add('pulse-animation');
            isListening = true;
          } else {
            // Stop listening
            recognition.stop();
            voiceStatus.textContent = 'Click to activate voice assistant';
            voiceButton.classList.remove('pulse-animation');
            isListening = false;
          }
        });

        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;

          // Add user message to chat
          addMessageToChat(transcript, 'user');

          // Process the command
          processVoiceCommand(transcript);

          // Reset UI
          voiceStatus.textContent = 'Click to activate voice assistant';
          voiceButton.classList.remove('pulse-animation');
          isListening = false;
        };

        recognition.onend = () => {
          voiceStatus.textContent = 'Click to activate voice assistant';
          voiceButton.classList.remove('pulse-animation');
          isListening = false;
        };

        recognition.onerror = (event) => {
          console.error('Speech recognition error', event.error);
          voiceStatus.textContent = `Error: ${event.error}`;
          voiceButton.classList.remove('pulse-animation');
          isListening = false;
        };

      } else {
        voiceStatus.textContent = 'Speech recognition not supported in this browser';
        voiceButton.disabled = true;
        voiceButton.classList.add('opacity-50');
      }
    }

    // Process voice commands
    function processVoiceCommand(command) {
      command = command.toLowerCase();
      let response = '';

      // Simple command processing
      if (command.includes('time')) {
        const now = new Date();
        response = `The time is ${now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}`;
      } else if (command.includes('date')) {
        const now = new Date();
        response = `Today is ${now.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}`;
      } else if (command.includes('weather')) {
        const temp = document.getElementById('temperature').textContent;
        const desc = document.getElementById('weather-description').textContent;
        response = `The current weather is ${temp} and ${desc}`;
      } else if (command.includes('news')) {
        response = 'Here are the latest headlines. You can see them on your screen.';
      } else if (command.includes('hello') || command.includes('hi')) {
        const userName = recognizedUser || (currentUser ? currentUser.name : 'there');
        response = `Hello, ${userName}! How can I help you today?`;
      } else if (command.includes('dark mode') || command.includes('light mode') || command.includes('theme')) {
        document.getElementById('theme-toggle').click();
        response = 'I\'ve toggled the theme for you';
      } else if (command.includes('who am i')) {
        if (recognizedUser) {
          response = `I recognize you as ${recognizedUser}`;
        } else if (currentUser) {
          response = `You're logged in as ${currentUser.name}`;
        } else {
          response = 'I don\'t recognize you yet. Would you like to add your face?';
        }
      } else if (command.includes('logout') || command.includes('sign out')) {
        response = 'Logging you out now.';
        setTimeout(() => {
          logoutUser();
        }, 1500);
      } else if (command.includes('insight') || command.includes('analysis')) {
        response = document.getElementById('gemini-insight').textContent;
      } else {
        // Use Gemini API for more complex queries
        response = 'I\'ll need to think about that. Let me check with my AI brain powered by Gemini.';

        // Simulate Gemini API call
        setTimeout(() => {
          const geminiResponse = "Based on my analysis, I think this is a question that would benefit from Gemini's advanced reasoning capabilities. In a full implementation, I would connect to the Gemini API to provide a more detailed and accurate response.";
          addMessageToChat(geminiResponse, 'assistant');
          speakText(geminiResponse);
        }, 2000);
      }

      // Add assistant response to chat
      addMessageToChat(response, 'assistant');

      // Speak response
      speakText(response);
    }

    // Text-to-Speech
    function speakText(text) {
      if ('speechSynthesis' in window) {
        const speech = new SpeechSynthesisUtterance(text);
        speech.lang = 'en-US';
        window.speechSynthesis.speak(speech);
      }
    }

    // Chat Interface
    function setupChatInterface() {
      const chatInput = document.getElementById('chat-input');
      const sendButton = document.getElementById('send-message');

      // Send message on button click
      sendButton.addEventListener('click', () => {
        sendMessage();
      });

      // Send message on Enter key
      chatInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          sendMessage();
        }
      });

      function sendMessage() {
        const message = chatInput.value.trim();
        if (message) {
          // Add user message to chat
          addMessageToChat(message, 'user');

          // Process command
          processVoiceCommand(message);

          // Clear input
          chatInput.value = '';
        }
      }
    }

    // Add message to chat
    function addMessageToChat(message, sender) {
      const chatContainer = document.getElementById('chat-container');
      const messageElement = document.createElement('div');

      messageElement.className = sender === 'user' ? 'user-message p-3 ml-auto max-w-3/4' : 'assistant-message p-3 max-w-3/4';
      messageElement.innerHTML = `<p>${message}</p>`;

      chatContainer.appendChild(messageElement);

      // Scroll to bottom
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Setup Smart Home Controls
    function setupSmartHomeControls() {
      const smartHomeButtons = document.querySelectorAll('.smart-home-button');

      smartHomeButtons.forEach(button => {
        button.addEventListener('click', () => {
          // Toggle active state
          button.classList.toggle('active');

          // Get the type of control
          const controlType = button.querySelector('span').textContent;

          // Simulate smart home action
          const isActive = button.classList.contains('active');
          const status = isActive ? 'on' : 'off';

          // Add message to chat
          addMessageToChat(`${controlType} turned ${status}`, 'assistant');

          // Speak confirmation
          speakText(`${controlType} turned ${status}`);
        });
      });
    }
  </script>
</body>

</html>